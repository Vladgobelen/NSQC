local i=pairs local x=table.insert local u=setmetatable local r=utf8myLen local l=CreateFrame local T=tonumber local S=utf8mySub local e=ipairs local N=string.gmatch local B=en85 local c=en10 local b=utf8mySub local o=utf8myLen local z=string.rep local s=string.sub NsDb={}NsDb.__index=NsDb function NsDb.new(T,i,x,r,l)local S=u({},T)S:init(i,x,r,l)return S end function NsDb.init(l,i,x,u,r)l.input_table=l:initializeTable(i,u)if x then l.input_table_p=l:initializeTable(x,u)end if r then l.str_len=r end l.isPointer=x and true or false if l.isPointer then if#l.input_table_p==0 then l.last_str_addr=0 l.str_count=0 else l.str_count=0 l.last_str_addr=c((l.input_table_p[#l.input_table_p]:sub(-2)):gsub("\094\037\115",""))for i=1,#l.input_table_p,1 do l.str_count=l.str_count+1 end end end end function NsDb.initializeTable(u,i,x)if x then i[x]=i[x]or{}return i[x]else return i or{}end end function NsDb.addStaticStr(l,i,x,u,r)l.input_table[i]=l.input_table[i]or{}if not u then l.input_table[i][x]=r return end local T=l.input_table[i][x]l.input_table[i][x]=T:sub(1,(u-1)*3)..(("   "..r):sub(-3)..T:sub(u*3+1))end function NsDb.getStaticStr(r,i,x,u)local l=r.input_table and(r.input_table[i]and r.input_table[i][x])return l and(u and s(l,(u-1)*3+1,u*3)or l)end function NsDb.addStr(x,i)local u=r(i)if x.last_str_addr>=x.str_len or x.str_count==0 then x.input_table[#x.input_table+1]=i local r=("   "..B(u)):sub(-3)x.input_table_p[#x.input_table_p+1]=r else x.input_table[#x.input_table]=x.input_table[#x.input_table]..i local r=("   "..B(x.last_str_addr+u)):sub(-3)x.input_table_p[#x.input_table_p]=x.input_table_p[#x.input_table_p]..r end x.last_str_addr=r(x.input_table[#x.input_table])x.str_count=#x.input_table_p end function NsDb.getStr(x,i)if not x.isPointer or i<1 then return nil end local u=0 for r=1,#x.input_table_p,1 do local l=#x.input_table_p[r]/3 if i>l+u then u=u+l else local l=(((i-1)-u)-1)*3+1 local T=(((i-u)-1)*3+1)+2 local e=(x.input_table_p[r]:sub(l,l+2)):match("\037\083\043\046\042")local N=(x.input_table_p[r]:sub(T-2,T)):match("\037\083\043\046\042")return S(x.input_table[r],c(e)+1,c(N))end end end function NsDb.create_bin(l,i,u)local T=B(r(i))T=string.len(T)<2 and" "..T or T if u==0 then x(l.input_table,i)x(l.input_table_p,T)else l.input_table[#l.input_table]=l.input_table[#l.input_table]..i l.input_table_p[#l.input_table_p]=l.input_table_p[#l.input_table_p]..T end end function NsDb.add_str(x,i)local u=#x.input_table if u<1 or r(x.input_table[u])>=x.str_len then x:create_bin(i,0)else x:create_bin(i,1)end end function NsDb.add_line(x,i)local u=#x.input_table if u<1 then x.input_table[u+1]={}x.input_table[u+1][#x.input_table[u+1]+1]=i else x.input_table[u][#x.input_table[u]+1]=i end end function NsDb.add_dict(u,i,x)local r=#u.input_table if r<1 or tablelength(u.input_table[r])>=u.str_len then u.input_table[r+1]={}u.input_table[r+1][i]=x else u.input_table[r][i]=x end end function NsDb.add_fdict(x,i)local u=#x.input_table local r=numCod(#i)r=string.len(r)<2 and" "..r or r if u<1 or#x.input_table[u]>=x.str_len then x.input_table[u+1]={}u=u+1 end for i,r in e(i)do x.input_table[u][#x.input_table[u]+1]=r end if x.input_table_p then x.input_table_p[u]=x.input_table_p[u]or{}x.input_table_p[u][1]=x.input_table_p[u][1]or""x.input_table_p[u][1]=x.input_table_p[u][1]..r end end function NsDb.get_fdict(x,i)if not x.input_table_p or not x.input_table_p[1]then return nil,"\208\162\208\176\208\177\208\187\208\184\209\134\208\176 \209\129 \208\176\208\180\209\128\208\181\209\129\208\176\208\188\208\184 \208\189\208\181 \208\189\208\176\208\185\208\180\208\181\208\189\208\176\046"end local u=1 local r=x.input_table_p[u][1]local l={}for i in string.gmatch(r,"\046\046")do table.insert(l,i)end while i>#l do u=u+1 if not x.input_table_p[u]then return nil,"\208\152\208\189\208\180\208\181\208\186\209\129 \208\178\208\189\208\181 \208\180\208\184\208\176\208\191\208\176\208\183\208\190\208\189\208\176\046"end r=x.input_table_p[u][1]l={}for i in string.gmatch(r,"\046\046")do table.insert(l,i)end end local T=l[i]local S=c(T)if not S then return nil,"\208\157\208\181\208\186\208\190\209\128\209\128\208\181\208\186\209\130\208\189\209\139\208\185 \208\176\208\180\209\128\208\181\209\129\058 "..T end local e=math.ceil(i/1000)if not x.input_table[e]then return nil,"\208\162\208\176\208\177\208\187\208\184\209\134\208\176 \209\129 \208\180\208\176\208\189\208\189\209\139\208\188\208\184 \208\189\208\181 \208\189\208\176\208\185\208\180\208\181\208\189\208\176\046"end local N=x.input_table[e]local B=1 for i=1,i-1,1 do local x=l[i]local u=numeCod(x)if not u then return nil,"\208\157\208\181\208\186\208\190\209\128\209\128\208\181\208\186\209\130\208\189\209\139\208\185 \208\176\208\180\209\128\208\181\209\129\058 "..x end B=B+u end if B<1 or(B+S)-1>#N then return nil,"\208\144\208\180\209\128\208\181\209\129 \208\178\208\189\208\181 \208\180\208\184\208\176\208\191\208\176\208\183\208\190\208\189\208\176 \208\180\208\176\208\189\208\189\209\139\209\133\046"end local b={}for i=B,(B+S)-1,1 do table.insert(b,N[i])end local o=table.concat(b," ")print(string.format("\208\144\208\180\209\128\208\181\209\129 \037\100\058 \037\115 \040\208\180\208\181\208\186\208\190\208\180\208\184\209\128\208\190\208\178\208\176\208\189\208\190\058 \037\100\041 -\062 \208\148\208\176\208\189\208\189\209\139\208\181\058 \037\115",i,T,S,o))return o end function NsDb.is_unique(x,i)for u=1,#x.input_table,1 do if x.input_table[u][i]then return false end end return true end function NsDb.pLen(i)local x=0 if i.input_table_p then for u=1,#i.input_table_p,1 do x=x+T(r(i.input_table_p[u]))/3 end return x else return nil end end function NsDb.Len(x)local u=0 for r=1,#x.input_table,1 do if type(x.input_table[r])=="\116\097\098\108\101"then for i in i(x.input_table[r])do u=u+1 end else u=u+#x.input_table[r]end end return u end function NsDb.modKey(i,...)local x=select("\035",...)if x<2 then return end local u=select(x,...)local r=select(x-1,...)if not r or u==nil then return end local l=i.input_table for i=1,x-2,1 do local x=select(i,...)if not x then return end local u=l[x]if not u then u={}l[x]=u end l=u end l[r]=u end function NsDb.getKey(i,...)local x=select("\035",...)if x==0 then return nil end local u=i.input_table for i=1,x-1,1 do local x=select(i,...)if type(u)~="\116\097\098\108\101"then return nil end u=u[x]if u==nil then return nil end end return type(u)=="\116\097\098\108\101"and u[select(x,...)]or nil end function NsDb.hasKey(x,i)return x.input_table and x.input_table[i]~=nil end function NsDb.createTable(x,i)x.input_table=x.input_table or{}x.input_table[i]={}end function NsDb.addToSubtable(u,i,x)if not u.input_table[i]then u.input_table[i]={}end if not u:isArray(u.input_table[i])then local x=u.input_table[i]u.input_table[i]={x}end table.insert(u.input_table[i],x)end function NsDb.isArray(u,x)if type(x)~="\116\097\098\108\101"then return false end local r=0 for i in i(x)do r=r+1 end return r==#x end function NsDb.getSubtableSize(i,...)local x=select("\035",...)if x==0 then return 0 end local u=i.input_table for i=1,x,1 do local x=select(i,...)if type(u)~="\116\097\098\108\101"then return 0 end u=u[x]if u==nil then return 0 end end return i:calculateTableSize(u)end function NsDb.calculateTableSize(u,x)if type(x)~="\116\097\098\108\101"then return 0 end local r=0 for i,x in i(x)do if type(x)=="\116\097\098\108\101"then r=r+u:calculateTableSize(x)else r=r+1 end end return r end function NsDb.TotalSize(x)if not x.input_table or type(x.input_table)~="\116\097\098\108\101"then return 0 end local u=0 for i,x in i(x.input_table)do if type(x)=="\116\097\098\108\101"then u=u+1 end end return u end GpDb={}GpDb.__index=GpDb function GpDb.new(x,i)local r={gp_data={};sort_column="\110\105\099\107";sort_ascending=true;visible_rows=20,selected_indices={},last_selected_index=nil;logData={}}u(r,x)r:_CreateWindow()r:_CreateRaidSelectionWindow()r:_CreateLogWindow()return r end function GpDb._CreateLogWindow(i)i.logWindow=l("\070\114\097\109\101","\071\112\068\098\076\111\103\087\105\110\100\111\119",i.window)i.logWindow:SetFrameStrata("\068\073\065\076\079\071")i.logWindow:SetSize(600,i.window:GetHeight())i.logWindow:SetPoint("\084\079\080\076\069\070\084",i.window,"\084\079\080\082\073\071\072\084",5,0)i.logWindow:SetMovable(false)i.logWindow:Hide()i.logWindow.background=i.logWindow:CreateTexture(nil,"\066\065\067\075\071\082\079\085\078\068")i.logWindow.background:SetTexture("\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\087\072\073\084\069\056\088\056")i.logWindow.background:SetVertexColor(.1,.1,.1)i.logWindow.background:SetAlpha(.9)i.logWindow.background:SetAllPoints(true)i.logWindow.borderFrame=l("\070\114\097\109\101",nil,i.logWindow)i.logWindow.borderFrame:SetPoint("\084\079\080\076\069\070\084",-3,3)i.logWindow.borderFrame:SetPoint("\066\079\084\084\079\077\082\073\071\072\084",3,-3)i.logWindow.borderFrame:SetBackdrop({edgeFile="\073\110\116\101\114\102\097\099\101\092\068\105\097\108\111\103\070\114\097\109\101\092\085\073-\068\105\097\108\111\103\066\111\120-\066\111\114\100\101\114";edgeSize=16,insets={left=4,right=4;top=4,bottom=4}})i.logWindow.closeButton=l("\066\117\116\116\111\110",nil,i.logWindow,"\085\073\080\097\110\101\108\067\108\111\115\101\066\117\116\116\111\110")i.logWindow.closeButton:SetPoint("\084\079\080\082\073\071\072\084",-5,-5)i.logWindow.closeButton:SetScript("\079\110\067\108\105\099\107",function()i.logWindow:Hide()end)i.logWindow.filters=l("\070\114\097\109\101",nil,i.logWindow)i.logWindow.filters:SetPoint("\084\079\080\076\069\070\084",10,-5)i.logWindow.filters:SetPoint("\082\073\071\072\084",-10,0)i.logWindow.filters:SetHeight(30)i.logWindow.countFilter=l("\069\100\105\116\066\111\120",nil,i.logWindow.filters,"\073\110\112\117\116\066\111\120\084\101\109\112\108\097\116\101")i.logWindow.countFilter:SetSize(60,20)i.logWindow.countFilter:SetPoint("\076\069\070\084",i.logWindow.filters,"\076\069\070\084")i.logWindow.countFilter:SetAutoFocus(false)i.logWindow.countFilter:SetText("\208\154\208\190\208\187-\208\178\208\190")i.logWindow.countFilter:SetScript("\079\110\069\115\099\097\112\101\080\114\101\115\115\101\100",function()i.logWindow.countFilter:ClearFocus()end)i.logWindow.countFilter:SetScript("\079\110\069\110\116\101\114\080\114\101\115\115\101\100",function()i.logWindow.countFilter:ClearFocus()i:UpdateLogDisplay()end)i.logWindow.timeFilter=l("\069\100\105\116\066\111\120",nil,i.logWindow.filters,"\073\110\112\117\116\066\111\120\084\101\109\112\108\097\116\101")i.logWindow.timeFilter:SetSize(70,20)i.logWindow.timeFilter:SetPoint("\076\069\070\084",i.logWindow.countFilter,"\082\073\071\072\084",5,0)i.logWindow.timeFilter:SetAutoFocus(false)i.logWindow.timeFilter:SetText("\208\146\209\128\208\181\208\188\209\143")i.logWindow.timeFilter:SetScript("\079\110\069\115\099\097\112\101\080\114\101\115\115\101\100",function()i.logWindow.timeFilter:ClearFocus()end)i.logWindow.timeFilter:SetScript("\079\110\069\110\116\101\114\080\114\101\115\115\101\100",function()i.logWindow.timeFilter:ClearFocus()i:UpdateLogDisplay()end)i.logWindow.rlFilter=l("\069\100\105\116\066\111\120",nil,i.logWindow.filters,"\073\110\112\117\116\066\111\120\084\101\109\112\108\097\116\101")i.logWindow.rlFilter:SetSize(70,20)i.logWindow.rlFilter:SetPoint("\076\069\070\084",i.logWindow.timeFilter,"\082\073\071\072\084",5,0)i.logWindow.rlFilter:SetAutoFocus(false)i.logWindow.rlFilter:SetText("\208\160\208\155")i.logWindow.rlFilter:SetScript("\079\110\069\115\099\097\112\101\080\114\101\115\115\101\100",function()i.logWindow.rlFilter:ClearFocus()end)i.logWindow.rlFilter:SetScript("\079\110\069\110\116\101\114\080\114\101\115\115\101\100",function()i.logWindow.rlFilter:ClearFocus()i:UpdateLogDisplay()end)i.logWindow.raidFilter=l("\069\100\105\116\066\111\120",nil,i.logWindow.filters,"\073\110\112\117\116\066\111\120\084\101\109\112\108\097\116\101")i.logWindow.raidFilter:SetSize(100,20)i.logWindow.raidFilter:SetPoint("\076\069\070\084",i.logWindow.rlFilter,"\082\073\071\072\084",5,0)i.logWindow.raidFilter:SetAutoFocus(false)i.logWindow.raidFilter:SetText("\208\160\208\181\208\185\208\180")i.logWindow.raidFilter:SetScript("\079\110\069\115\099\097\112\101\080\114\101\115\115\101\100",function()i.logWindow.raidFilter:ClearFocus()end)i.logWindow.raidFilter:SetScript("\079\110\069\110\116\101\114\080\114\101\115\115\101\100",function()i.logWindow.raidFilter:ClearFocus()i:UpdateLogDisplay()end)i.logWindow.nameFilter=l("\069\100\105\116\066\111\120",nil,i.logWindow.filters,"\073\110\112\117\116\066\111\120\084\101\109\112\108\097\116\101")i.logWindow.nameFilter:SetSize(100,20)i.logWindow.nameFilter:SetPoint("\076\069\070\084",i.logWindow.raidFilter,"\082\073\071\072\084",5,0)i.logWindow.nameFilter:SetAutoFocus(false)i.logWindow.nameFilter:SetText("\208\157\208\184\208\186")i.logWindow.nameFilter:SetScript("\079\110\069\115\099\097\112\101\080\114\101\115\115\101\100",function()i.logWindow.nameFilter:ClearFocus()end)i.logWindow.nameFilter:SetScript("\079\110\069\110\116\101\114\080\114\101\115\115\101\100",function()i.logWindow.nameFilter:ClearFocus()i:UpdateLogDisplay()end)i.logWindow.showButton=l("\066\117\116\116\111\110",nil,i.logWindow.filters,"\085\073\080\097\110\101\108\066\117\116\116\111\110\084\101\109\112\108\097\116\101")i.logWindow.showButton:SetSize(80,22)i.logWindow.showButton:SetPoint("\076\069\070\084",i.logWindow.nameFilter,"\082\073\071\072\084",5,0)i.logWindow.showButton:SetText("\208\159\208\190\208\186\208\176\208\183\208\176\209\130\209\140")i.logWindow.showButton:SetScript("\079\110\067\108\105\099\107",function()local function x(i)if i:find("\037\115")then i=i:gsub("\037\115\043","\095")end return i end local u=x(i.logWindow.countFilter:GetText())local r=x(i.logWindow.timeFilter:GetText())local l=x(i.logWindow.rlFilter:GetText())local T=x(i.logWindow.raidFilter:GetText())local S=x(i.logWindow.nameFilter:GetText())gpDb:ClearLog()SendAddonMessage("\078\083\083\104\111\119\077\101\076\111\103\115",u..(" "..(r..(" "..(l..(" "..(T..(" "..S))))))),"\103\117\105\108\100")end)i.logWindow.scrollFrame=l("\083\099\114\111\108\108\070\114\097\109\101","\071\112\068\098\076\111\103\083\099\114\111\108\108\070\114\097\109\101",i.logWindow,"\085\073\080\097\110\101\108\083\099\114\111\108\108\070\114\097\109\101\084\101\109\112\108\097\116\101")i.logWindow.scrollFrame:SetPoint("\084\079\080\076\069\070\084",0,-35)i.logWindow.scrollFrame:SetPoint("\066\079\084\084\079\077\082\073\071\072\084",0,10)i.logWindow.scrollChild=l("\070\114\097\109\101")i.logWindow.scrollChild:SetSize(580,1000)i.logWindow.scrollFrame:SetScrollChild(i.logWindow.scrollChild)i.logRows={}for x=1,50,1 do local u=l("\070\114\097\109\101","\071\112\068\098\076\111\103\082\111\119"..x,i.logWindow.scrollChild)u:SetSize(580,40)u:SetPoint("\084\079\080\076\069\070\084",0,-((x-1)*40))u.text=u:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108\083\109\097\108\108")u.text:SetAllPoints(true)u.text:SetJustifyH("\076\069\070\084")u.text:SetJustifyV("\084\079\080")u.text:SetWordWrap(true)u.text:SetText("")i.logRows[x]=u end end function GpDb.ClearLog(i)i.logData={}i.logWindow.countFilter:SetText("\208\154\208\190\208\187-\208\178\208\190")i.logWindow.timeFilter:SetText("\208\146\209\128\208\181\208\188\209\143")i.logWindow.rlFilter:SetText("\208\160\208\155")i.logWindow.raidFilter:SetText("\208\160\208\181\208\185\208\180")i.logWindow.nameFilter:SetText("\208\157\208\184\208\186")i:UpdateLogDisplay()print("\124\099\070\070\070\070\048\048\048\048\208\147\208\159\058\124\114 \208\155\208\190\208\179 \209\131\209\129\208\191\208\181\209\136\208\189\208\190 \208\190\209\135\208\184\209\137\208\181\208\189")end function GpDb._CreateWindow(i)i.window=l("\070\114\097\109\101","\071\112\084\114\097\099\107\101\114\087\105\110\100\111\119",UIParent)i.window:SetFrameStrata("\068\073\065\076\079\071")i.window:SetSize(400,500)i.window:SetPoint("\076\069\070\084",5,100)i.window:SetMovable(true)i.window:EnableMouse(true)i.window:RegisterForDrag("\076\101\102\116\066\117\116\116\111\110")i.window:SetScript("\079\110\068\114\097\103\083\116\097\114\116",i.window.StartMoving)i.window:SetScript("\079\110\068\114\097\103\083\116\111\112",i.window.StopMovingOrSizing)i.window:Hide()i.window.background=i.window:CreateTexture(nil,"\066\065\067\075\071\082\079\085\078\068")i.window.background:SetTexture("\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\087\072\073\084\069\056\088\056")i.window.background:SetVertexColor(0,0,0)i.window.background:SetAlpha(1)i.window.background:SetAllPoints(true)i.window.borderFrame=l("\070\114\097\109\101",nil,i.window)i.window.borderFrame:SetPoint("\084\079\080\076\069\070\084",-3,3)i.window.borderFrame:SetPoint("\066\079\084\084\079\077\082\073\071\072\084",3,-3)i.window.borderFrame:SetBackdrop({edgeFile="\073\110\116\101\114\102\097\099\101\092\068\105\097\108\111\103\070\114\097\109\101\092\085\073-\068\105\097\108\111\103\066\111\120-\066\111\114\100\101\114";edgeSize=16;insets={left=4,right=4;top=4,bottom=4}})i.window.title=i.window:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108")i.window.title:SetPoint("\084\079\080",0,-15)i.window.title:SetText("")i.window.closeButton=l("\066\117\116\116\111\110",nil,i.window,"\085\073\080\097\110\101\108\067\108\111\115\101\066\117\116\116\111\110")i.window.closeButton:SetPoint("\084\079\080\082\073\071\072\084",-5,-5)i.window.closeButton:SetScript("\079\110\067\108\105\099\107",function()i.window:Hide()end)i.window.logButton=l("\066\117\116\116\111\110",nil,i.window,"\085\073\080\097\110\101\108\066\117\116\116\111\110\084\101\109\112\108\097\116\101")i.window.logButton:SetSize(24,24)i.window.logButton:SetPoint("\082\073\071\072\084",i.window.closeButton,"\076\069\070\084",-5,0)i.window.logButton:SetText("\076")i.window.logButton:SetScript("\079\110\067\108\105\099\107",function()i:ToggleLogWindow()end)i.window.raidOnlyCheckbox=l("\067\104\101\099\107\066\117\116\116\111\110",nil,i.window,"\085\073\067\104\101\099\107\066\117\116\116\111\110\084\101\109\112\108\097\116\101")i.window.raidOnlyCheckbox:SetPoint("\084\079\080\076\069\070\084",10,-15)i.window.raidOnlyCheckbox:SetSize(24,24)i.window.raidOnlyCheckbox.text=i.window.raidOnlyCheckbox:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108")i.window.raidOnlyCheckbox.text:SetPoint("\076\069\070\084",i.window.raidOnlyCheckbox,"\082\073\071\072\084",5,0)i.window.raidOnlyCheckbox.text:SetText("\208\162\208\190\208\187\209\140\208\186\208\190 \209\128\208\181\208\185\208\180")i.window.raidOnlyCheckbox:SetScript("\079\110\067\108\105\099\107",function()i:_UpdateFromGuild()i:UpdateWindow()end)i.window.scrollFrame=l("\083\099\114\111\108\108\070\114\097\109\101","\083\099\114\111\108\108\070\114\097\109\101",i.window,"\085\073\080\097\110\101\108\083\099\114\111\108\108\070\114\097\109\101\084\101\109\112\108\097\116\101")i.window.scrollFrame:SetPoint("\084\079\080\076\069\070\084",0,-40)i.window.scrollFrame:SetPoint("\066\079\084\084\079\077\082\073\071\072\084",0,40)i.window.scrollChild=l("\070\114\097\109\101")i.window.scrollChild:SetSize(380,500)i.window.scrollFrame:SetScrollChild(i.window.scrollChild)i.window.scrollBar=_G[i.window.scrollFrame:GetName().."\083\099\114\111\108\108\066\097\114"]i.window.scrollBar:SetPoint("\084\079\080\076\069\070\084",i.window.scrollFrame,"\084\079\080\082\073\071\072\084",-20,-16)i.window.scrollBar:SetPoint("\066\079\084\084\079\077\076\069\070\084",i.window.scrollFrame,"\066\079\084\084\079\077\082\073\071\072\084",-20,16)i.window.countText=i.window:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108")i.window.countText:SetPoint("\066\079\084\084\079\077\076\069\070\084",10,10)i.window.countText:SetPoint("\066\079\084\084\079\077\082\073\071\072\084",-10,10)i.window.countText:SetJustifyH("\076\069\070\084")i.window.countText:SetText("")i.window.totalText=i.window:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108")i.window.totalText:SetPoint("\066\079\084\084\079\077\076\069\070\084",10,30)i.window.totalText:SetPoint("\066\079\084\084\079\077\082\073\071\072\084",-10,30)i.window.totalText:SetJustifyH("\076\069\070\084")i.window.totalText:SetText("")i:_SetupTable()end function GpDb._SetupTable(x)local u={"\208\157\208\184\208\186";"\208\147\208\159"}for i,u in e(u)do local r=l("\066\117\116\116\111\110",nil,x.window.scrollChild)r:SetSize(i==1 and 290 or 50,20)r:SetPoint("\084\079\080\076\069\070\084",(i-1)*290+(i==2 and 10 or 0),0)r:SetNormalFontObject("\071\097\109\101\070\111\110\116\078\111\114\109\097\108")r:SetHighlightFontObject("\071\097\109\101\070\111\110\116\072\105\103\104\108\105\103\104\116")local T=r:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108")T:SetAllPoints(true)T:SetText(u)r:SetScript("\079\110\067\108\105\099\107",function()x:SortData(u:lower())x:UpdateWindow()end)end x.rows={}for u=1,999,1 do local r=l("\066\117\116\116\111\110","\071\112\068\098\082\111\119"..u,x.window.scrollChild)r:SetSize(350,20)r:SetPoint("\084\079\080\076\069\070\084",0,-25-(u-1)*25)r:EnableMouse(true)r:RegisterForClicks("\076\101\102\116\066\117\116\116\111\110\085\112","\082\105\103\104\116\066\117\116\116\111\110\085\112")r:SetHighlightTexture("\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\087\072\073\084\069\056\088\056");(r:GetHighlightTexture()):SetVertexColor(.4,.4,.8,.4)r.selection=r:CreateTexture(nil,"\066\065\067\075\071\082\079\085\078\068")r.selection:SetAllPoints(true)r.selection:SetTexture("\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\087\072\073\084\069\056\088\056")r.selection:SetVertexColor(.3,.3,.7,.7)r.selection:Hide()r.nick=r:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108")r.nick:SetPoint("\076\069\070\084",10,0)r.nick:SetWidth(290)r.nick:SetJustifyH("\076\069\070\084")r.gp=r:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108")r.gp:SetPoint("\082\073\071\072\084",5,0)r.gp:SetWidth(50)r.gp:SetJustifyH("\082\073\071\072\084")r.lastClickTime=0 r:SetScript("\079\110\067\108\105\099\107",function(l,T,S)local e=FauxScrollFrame_GetOffset(x.window.scrollFrame)local N=u+e if not x.gp_data or not x.gp_data[N]then return end local B=GetTime()if T=="\076\101\102\116\066\117\116\116\111\110"and(IsInRaid()and B-r.lastClickTime<.5)then x:ClearSelection()for i=1,#x.gp_data,1 do x.selected_indices[i]=true end x.last_selected_index=N x:_UpdateSelectionCount()x:RefreshRowHighlights()x:UpdateRaidWindowVisibility()if x.raidWindow and x.raidWindow:IsShown()then x:_UpdateSelectedPlayersText()end r.lastClickTime=0 return end r.lastClickTime=B if T=="\076\101\102\116\066\117\116\116\111\110"then local u=x.selected_indices[N]if IsShiftKeyDown()then if not x.last_selected_index then x:ClearSelection()x.selected_indices[N]=true x.last_selected_index=N else local i=math.min(x.last_selected_index,N)local u=math.max(x.last_selected_index,N)if not IsControlKeyDown()then x:ClearSelection()end for i=i,u,1 do if x.gp_data[i]then x.selected_indices[i]=true end end end elseif IsControlKeyDown()then x.selected_indices[N]=not u for i in i(x.selected_indices)do if not x.gp_data[i]then x.selected_indices[i]=nil end end if x.selected_indices[N]then x.last_selected_index=N else x.last_selected_index=nil for i in i(x.selected_indices)do if x.selected_indices[i]then x.last_selected_index=i break end end end else if u then x:ClearSelection()else x:ClearSelection()x.selected_indices[N]=true x.last_selected_index=N end end x:_UpdateSelectionCount()x:RefreshRowHighlights()x:UpdateRaidWindowVisibility()if x.raidWindow and x.raidWindow:IsShown()then x:_UpdateSelectedPlayersText()end end end)x.rows[u]=r end x.window:SetScript("\079\110\072\105\100\101",function()x:ClearSelection()if x.raidWindow and x.raidWindow:IsShown()then x.raidWindow:Hide()end if x.logWindow and x.logWindow:IsShown()then x.logWindow:Hide()end end)end function GpDb.ToggleLogWindow(i)if not i.logWindow then i:_CreateLogWindow()end if i.logWindow:IsShown()then i.logWindow:Hide()else i.logWindow:Show()i:UpdateLogDisplay()if i.raidWindow and i.raidWindow:IsShown()then i.logWindow:SetHeight(i.window:GetHeight()/2)else i.logWindow:SetHeight(i.window:GetHeight())end end end function GpDb.UpdateLogDisplay(i)if not i.logWindow or not i.logWindow:IsShown()then return end local x=0 local u={}for r,l in e(i.logData)do local T=i.logWindow.scrollChild:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108\083\109\097\108\108")T:SetWidth(580)T:SetText(l.text)T:SetWordWrap(true)local S=T:GetStringHeight()+5 u[r]=S x=x+S T:Hide()end local r=0 for x=1,#i.logRows,1 do local l=x if l<=#i.logData then local T=i.logData[l]local S=u[l]i.logRows[x]:SetHeight(S)i.logRows[x]:SetPoint("\084\079\080\076\069\070\084",0,-r)i.logRows[x].text:SetText(T.text)i.logRows[x]:Show()r=r+S else i.logRows[x]:Hide()end end i.logWindow.scrollChild:SetHeight(x)i.logWindow.scrollFrame:UpdateScrollChildRect()end function GpDb._UpdateSelectionCount(x)local u=0 for i,r in i(x.selected_indices)do if r and x.gp_data[i]then u=u+1 else x.selected_indices[i]=nil end end x.window.countText:SetText(string.format("\208\146\209\139\208\180\208\181\208\187\208\181\208\189\208\190\058 \037\100",u))if u==0 then x.last_selected_index=nil end return u end function GpDb.IsValidIndex(x,i)return i and(type(i)=="\110\117\109\098\101\114"and(x.gp_data and x.gp_data[i]))end function GpDb.RefreshRowHighlights(x)local u=FauxScrollFrame_GetOffset(x.window.scrollFrame)for i,r in e(x.rows)do local l=i+u if l<=#x.gp_data then if x.selected_indices[l]then r.selection:Show();(r:GetHighlightTexture()):SetAlpha(.2)else r.selection:Hide();(r:GetHighlightTexture()):SetAlpha(.4)end end end local r=0 for i in i(x.selected_indices)do r=r+1 end x.window.countText:SetText(string.format("\208\146\209\139\208\180\208\181\208\187\208\181\208\189\208\190\058 \037\100",r))end function GpDb.ClearSelection(i)i.selected_indices={}i.last_selected_index=nil i:_UpdateSelectionCount()i:RefreshRowHighlights()i:UpdateRaidWindowVisibility()end function GpDb.GetSelectedEntries(x)local u={}for i,r in i(x.selected_indices)do if i<=#x.gp_data then table.insert(u,x.gp_data[i])end end return u end function GpDb_old.AddLogEntry(S,i,x,u,r,l)if not S.logWindow then S:_CreateLogWindow()end local function e(i)if not i or type(i)~="\115\116\114\105\110\103"or i==""then return"\124\099\070\070\070\070\070\070\070\070"end local x=i:match("\094\040\046-\041-")or i for i=1,GetNumGuildMembers(),1 do local u,r,l,T,S,e,N,B,c,b,o=GetGuildRosterInfo(i)if u and u==x then local i=RAID_CLASS_COLORS[o]if i then return string.format("\124\099\070\070\037\048\050\120\037\048\050\120\037\048\050\120",i.r*255,i.g*255,i.b*255)end break end end return"\124\099\070\070\070\070\070\070\070\070"end local N=T(x)or 0 local B="\124\099\070\070\065\048\065\048\065\048"..((i or date("\037\072\058\037\077")).."\124\114")local c=type(u)=="\115\116\114\105\110\103"and u or UnitName("\112\108\097\121\101\114")or"\208\157\208\181\208\184\208\183\208\178\208\181\209\129\209\130\208\189\208\190"local b=e(c)..(c.."\124\114")local o=N>=0 and"\124\099\070\070\048\048\070\070\048\048"or"\124\099\070\070\070\070\048\048\048\048"local z=o..(tostring(N).."\124\114")local s=type(r)=="\115\116\114\105\110\103"and r or"\208\157\208\181\208\184\208\183\208\178\208\181\209\129\209\130\208\189\208\190"local C="\124\099\070\070\070\070\070\070\048\048"..(s.."\124\114")local O=type(l)=="\115\116\114\105\110\103"and l or"\208\157\208\181\208\184\208\183\208\178\208\181\209\129\209\130\208\189\208\190"local d={}for i in O:gmatch("\037\083\043")do table.insert(d,e(i)..(i.."\124\114"))end local H=table.concat(d," ")local h=string.format("\037\115 \124 \037\115 \124 \037\115 \124 \037\115 \124 \037\115",B,b,z,C,H)table.insert(S.logData,{text=h;raw={time=i or date("\037\072\058\037\077"),rl=c,gp=N,raid=s,targets=O}})if#S.logData>200 then table.remove(S.logData,1)end if S.logWindow and S.logWindow:IsShown()then S:UpdateLogDisplay()S.logWindow.scrollFrame:SetVerticalScroll(S.logWindow.scrollFrame:GetVerticalScrollRange())end end function GpDb.UpdateRaidWindowVisibility(x)if not x.raidWindow then return end local u=x:_CheckOfficerRank()if not u then if x.raidWindow:IsShown()then x.raidWindow:Hide()if x.logWindow and x.logWindow:IsShown()then x.logWindow:SetHeight(x.window:GetHeight())end end return end local r=next(x.selected_indices)~=nil if not r then if x.raidWindow:IsShown()then x.raidWindow:Hide()if x.logWindow and x.logWindow:IsShown()then x.logWindow:SetHeight(x.window:GetHeight())end end return end local l=IsInRaid()local T=x.window.raidOnlyCheckbox:GetChecked()local S=not l or T if S and l then local u={}for i=1,GetNumGroupMembers(),1 do local x=GetRaidRosterInfo(i)if x then u[x]=true end end for i in i(x.selected_indices)do local r=x.gp_data[i]if r and not u[r.original_nick]then S=false print("\124\099\070\070\070\070\048\048\048\048\208\147\208\159\058\124\114 \208\157\208\181\208\186\208\190\209\130\208\190\209\128\209\139\208\181 \208\178\209\139\208\180\208\181\208\187\208\181\208\189\208\189\209\139\208\181 \208\184\208\179\209\128\208\190\208\186\208\184 \208\189\208\181 \208\178 \209\128\208\181\208\185\208\180\208\181")break end end end if S then if not x.raidWindow:IsShown()then x.raidWindow:Show()x:RestoreRaidWindowState()x:_UpdateSelectedPlayersText()if x.logWindow and x.logWindow:IsShown()then x.logWindow:SetHeight(x.window:GetHeight()/2)end end else if x.raidWindow:IsShown()then x.raidWindow:Hide()end if x.logWindow and x.logWindow:IsShown()then x.logWindow:SetHeight(x.window:GetHeight())end end end function GpDb.UpdateWindow(i)if not i.window or not i.rows then return end local x=FauxScrollFrame_GetOffset(i.window.scrollFrame)for u=1,i.visible_rows,1 do local r=i.rows[u]local l=u+x if l<=#i.gp_data then local x=i.gp_data[l]r.nick:SetText(x.nick)r.gp:SetText(tostring(x.gp))if x.classColor then r.nick:SetTextColor(x.classColor.r,x.classColor.g,x.classColor.b)else r.nick:SetTextColor(1,1,1)end r:Show()else r:Hide()end end i:RefreshRowHighlights()FauxScrollFrame_Update(i.window.scrollFrame,#i.gp_data,i.visible_rows,25)i:UpdateRaidWindowVisibility()end function GpDb.GetNumSelected(x)local u=0 for i in i(x.selected_indices)do if x.gp_data[i]then u=u+1 else x.selected_indices[i]=nil end end print(string.format("\071\101\116\078\117\109\083\101\108\101\099\116\101\100\058 \208\189\208\176\208\185\208\180\208\181\208\189\208\190 \037\100 \209\141\208\187\208\181\208\188\208\181\208\189\209\130\208\190\208\178",u))return u end function GpDb.Show(i)i.window:Show()i.window.raidOnlyCheckbox:SetChecked(IsInRaid())i:_UpdateFromGuild()i:UpdateWindow()end function GpDb.Hide(i)i.window:Hide()end function GpDb._UpdateFromGuild(i)i.gp_data={}local x=0 local u=GetNumGuildMembers()local r=IsInRaid()i.window.raidOnlyCheckbox:SetChecked(r)local l=r and i.window.raidOnlyCheckbox:GetChecked()if not IsInGuild()then print("\124\099\070\070\070\070\048\048\048\048\208\147\208\159\058\124\114 \208\146\209\139 \208\189\208\181 \209\129\208\190\209\129\209\130\208\190\208\184\209\130\208\181 \208\178 \208\179\208\184\208\187\209\140\208\180\208\184\208\184")i:UpdateWindow()return end GuildRoster()C_Timer(.5,function()local r={}for i=1,GetNumGuildMembers(),1 do local x,u,l,T,S,e,N,B,c,b,o=GetGuildRosterInfo(i)if x then local i=nil if B then local x={}for i in B:gmatch("\037\083\043")do table.insert(x,i)end if#x>=2 then i=x[2]end end r[x]={publicNote=N;officerNote=B;classFileName=o,playerID=i}end end if l then local l=GetNumGroupMembers()local S=true local e={}for i=1,l,1 do local x,u,l,T,N,B,c,b,o,z,s,C,O,d,H,h,w,m=GetRaidRosterInfo(i)if x then local i=x:match("\094\040\046-\041-")or x if not r[i]then S=false table.insert(e,x)end end end if not S then print("\124\099\070\070\070\070\048\048\048\048\208\147\208\159\058\124\114 \208\146 \209\128\208\181\208\185\208\180\208\181 \208\181\209\129\209\130\209\140 \208\189\208\181 \209\135\208\187\208\181\208\189\209\139 \208\179\208\184\208\187\209\140\208\180\208\184\208\184\058 "..table.concat(e,"\044 "))i.window.countText:SetText("\208\158\209\130\208\190\208\177\209\128\208\176\208\182\208\176\208\181\209\130\209\129\209\143 \208\184\208\179\209\128\208\190\208\186\208\190\208\178\058 \048 \040\208\178 \209\128\208\181\208\185\208\180\208\181 \208\181\209\129\209\130\209\140 \208\189\208\181 \209\135\208\187\208\181\208\189\209\139 \208\179\208\184\208\187\209\140\208\180\208\184\208\184\041")i.window.totalText:SetText(string.format("\208\146\209\129\208\181\208\179\208\190 \208\184\208\179\209\128\208\190\208\186\208\190\208\178 \209\129 \208\147\208\159\058 \037\100 \040\208\184\208\183 \037\100 \208\178 \208\179\208\184\208\187\209\140\208\180\208\184\208\184\041",x,u))i:UpdateWindow()return end for u=1,l,1 do local l,S,e,N,B,c=GetRaidRosterInfo(u)if l then local u=l:match("\094\040\046-\041-")or l local S=r[u]if S then local u=0 local r=S.publicNote or""if S.officerNote then local i={}for x in S.officerNote:gmatch("\037\083\043")do table.insert(i,x)end if#i>=3 then u=T(i[3])or 0 end end if u>0 then x=x+1 end local e=l if r and r~=""then e=l..(" \124\099\070\070\070\070\070\070\048\048\040"..(r.."\041\124\114"))end table.insert(i.gp_data,{nick=e,original_nick=l,gp=u;classColor=RAID_CLASS_COLORS[c]or{r=1;g=1,b=1},classFileName=c;playerID=S.playerID})end end end else for u=1,GetNumGuildMembers(),1 do local r,l,S,e,N,B,c,b,o,z,s=GetGuildRosterInfo(u)if r and(b and b~="")then local u={}for i in b:gmatch("\037\083\043")do table.insert(u,i)end if#u>=3 then local l=T(u[3])or 0 local S=u[2]if l~=0 then x=x+1 local u=r if c and c~=""then u=r..(" \124\099\070\070\070\070\070\070\048\048\040"..(c.."\041\124\114"))end table.insert(i.gp_data,{nick=u,original_nick=r,gp=l,classColor=RAID_CLASS_COLORS[s]or{r=1,g=1,b=1},classFileName=s;playerID=S})end end end end end i.window.countText:SetText(string.format("\208\158\209\130\208\190\208\177\209\128\208\176\208\182\208\176\208\181\209\130\209\129\209\143 \208\184\208\179\209\128\208\190\208\186\208\190\208\178\058 \037\100",#i.gp_data))i.window.totalText:SetText(string.format("\208\146\209\129\208\181\208\179\208\190 \208\184\208\179\209\128\208\190\208\186\208\190\208\178 \209\129 \208\147\208\159\058 \037\100 \040\208\184\208\183 \037\100 \208\178 \208\179\208\184\208\187\209\140\208\180\208\184\208\184\041",x,GetNumGuildMembers()))i:ClearSelection()i:SortData()i:UpdateWindow()end)end function GpDb.Show(i)i.window:Show()if IsInRaid()then i.window.raidOnlyCheckbox:SetChecked(true)else i.window.raidOnlyCheckbox:SetChecked(false)end GuildRoster()C_Timer(.5,function()i:_UpdateFromGuild()i:UpdateWindow()end)end function GpDb.AddGpEntry(r,i,x,u)table.insert(r.gp_data,{nick=i;original_nick=i;gp=T(x)or 0;playerID=u})r:SortData()r:UpdateWindow()end function GpDb.UpdateGpEntry(u,i,x)for u,r in e(u.gp_data)do if r.original_nick==i then r.gp=T(x)or 0 break end end u:SortData()u:UpdateWindow()end function GpDb.RemoveGpEntry(x,i)for u,r in e(x.gp_data)do if r.original_nick==i then table.remove(x.gp_data,u)break end end x:UpdateWindow()end function GpDb.FindGpEntry(x,i)for x,u in e(x.gp_data)do if u.original_nick==i then return u.gp end end return nil end function GpDb.ClearAll(i)i.gp_data={}i:UpdateWindow()end function GpDb.SortData(x,i)if i then if x.sort_column==i then x.sort_ascending=not x.sort_ascending else x.sort_column=i x.sort_ascending=true end end table.sort(x.gp_data,function(i,u)local r,l if x.sort_column=="\110\105\099\107"then r=string.lower(string.lower(i.original_nick or""))l=string.lower(string.lower(u.original_nick or""))else r=i.gp or 0 l=u.gp or 0 end if x.sort_ascending then return r<l else return r>l end end)x:ClearSelection()x:UpdateWindow()end function GpDb.UpdateWindow(i)if not i.window or not i.rows then return end for x,u in e(i.rows)do local r=i.gp_data[x]if r then u.nick:SetText(r.nick)if r.classColor then local i=r.nick:match("\094\091\094\124\093\043")or r.nick u.nick:SetText(i)u.nick:SetTextColor(r.classColor.r,r.classColor.g,r.classColor.b)local x=r.nick:match("\124\099\046\043\036")if x then local i=u.nick:GetText()..(" "..x)u.nick:SetText(i)end else u.nick:SetTextColor(1,1,1)end u.gp:SetText(tostring(r.gp))u.gp:SetTextColor(1,1,1)u:Show()else u:Hide()end end i.window.scrollChild:SetHeight(#i.gp_data*25)i.window.scrollFrame:UpdateScrollChildRect()end function GpDb.SaveToNsDb(i)for x,u in e(i.gp_data)do i.ns_db:addStaticStr("\071\080\095\068\065\084\065",u.original_nick,nil,tostring(u.gp))end end function GpDb.LoadFromNsDb(x)x.gp_data={}local u=x.ns_db.input_table.GP_DATA if u then for i,u in i(u)do table.insert(x.gp_data,{nick=i;original_nick=i,gp=T(u)or 0})end end x:SortData()x:UpdateWindow()end function GpDb._CreateRaidSelectionWindow(x)x.raidWindow=l("\070\114\097\109\101","\071\112\068\098\082\097\105\100\087\105\110\100\111\119",x.window)x.raidWindow:SetFrameStrata("\068\073\065\076\079\071")x.raidWindow:SetSize(250,x.window:GetHeight()*.5)x.raidWindow:SetPoint("\066\079\084\084\079\077\076\069\070\084",x.window,"\066\079\084\084\079\077\082\073\071\072\084",5,0)x.raidWindow:SetMovable(false)x.raidWindow.background=x.raidWindow:CreateTexture(nil,"\066\065\067\075\071\082\079\085\078\068")x.raidWindow.background:SetTexture("\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\087\072\073\084\069\056\088\056")x.raidWindow.background:SetVertexColor(0,0,0)x.raidWindow.background:SetAlpha(1)x.raidWindow.background:SetAllPoints(true)x.raidWindow.borderFrame=l("\070\114\097\109\101",nil,x.raidWindow)x.raidWindow.borderFrame:SetPoint("\084\079\080\076\069\070\084",-3,3)x.raidWindow.borderFrame:SetPoint("\066\079\084\084\079\077\082\073\071\072\084",3,-3)x.raidWindow.borderFrame:SetBackdrop({edgeFile="\073\110\116\101\114\102\097\099\101\092\068\105\097\108\111\103\070\114\097\109\101\092\085\073-\068\105\097\108\111\103\066\111\120-\066\111\114\100\101\114";edgeSize=16,insets={left=4;right=4,top=4;bottom=4}})x.raidWindow.closeButton=l("\066\117\116\116\111\110",nil,x.raidWindow,"\085\073\080\097\110\101\108\067\108\111\115\101\066\117\116\116\111\110")x.raidWindow.closeButton:SetPoint("\084\079\080\082\073\071\072\084",-5,-5)x.raidWindow.closeButton:SetScript("\079\110\067\108\105\099\107",function()x.raidWindow:Hide()end)x.raidWindow.dropdown=l("\070\114\097\109\101","\071\112\068\098\082\097\105\100\068\114\111\112\100\111\119\110",x.raidWindow,"\085\073\068\114\111\112\068\111\119\110\077\101\110\117\084\101\109\112\108\097\116\101")x.raidWindow.dropdown:SetPoint("\084\079\080\076\069\070\084",10,-10)x.raidWindow.dropdown:SetPoint("\082\073\071\072\084",x.raidWindow.closeButton,"\076\069\070\084",-10,0)x.raidWindow.dropdown:SetHeight(32)local function u()if x.raidWindow.selectedRaidId then for i=1,GetNumSavedInstances(),1 do local u,r=GetSavedInstanceInfo(i)if r==x.raidWindow.selectedRaidId then UIDropDownMenu_SetText(x.raidWindow.dropdown,string.format("\037\100\058 \037\115",r,u))return end end else UIDropDownMenu_SetText(x.raidWindow.dropdown,"\208\146\209\139\208\177\208\181\209\128\208\184\209\130\208\181 \209\128\208\181\208\185\208\180")end end local function r(i,r,l)local T=UIDropDownMenu_CreateInfo()for i=1,GetNumSavedInstances(),1 do local r,l,S,e,N,B,c,b,o=GetSavedInstanceInfo(i)if r and l then T.text=string.format("\037\100\058 \037\115 \040\037\100\041",l,r,o)T.arg1={id=l;name=r;players=o}T.func=function(i,r)x.raidWindow.selectedRaidId=r.id x.raidWindow.selectedRaidName=r.name x.raidWindow.selectedRaidPlayers=r.players if x.saveSelectionEnabled then x.lastSelectionType="\114\097\105\100"x.lastRaidId=r.id x.lastRaidName=r.name x.lastRaidPlayers=r.players end u()x.raidWindow.editBox:SetText("")end T.checked=x.raidWindow.selectedRaidId==l UIDropDownMenu_AddButton(T)end end T.text="\208\158\209\135\208\184\209\129\209\130\208\184\209\130\209\140 \208\178\209\139\208\177\208\190\209\128"T.func=function()x.raidWindow.selectedRaidId=nil x.raidWindow.selectedRaidName=nil if x.saveSelectionEnabled then x.lastSelectionType=nil x.lastRaidId=nil x.lastRaidName=nil x.lastRaidPlayers=0 end u()end T.notCheckable=true UIDropDownMenu_AddButton(T)end UIDropDownMenu_Initialize(x.raidWindow.dropdown,r)UIDropDownMenu_SetWidth(x.raidWindow.dropdown,200)UIDropDownMenu_SetButtonWidth(x.raidWindow.dropdown,224)UIDropDownMenu_JustifyText(x.raidWindow.dropdown,"\076\069\070\084")u()x.raidWindow.otherText=x.raidWindow:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108")x.raidWindow.otherText:SetPoint("\084\079\080\076\069\070\084",x.raidWindow.dropdown,"\066\079\084\084\079\077\076\069\070\084",0,-10)x.raidWindow.otherText:SetText("\208\148\209\128\209\131\208\179\208\190\208\181\058")x.raidWindow.editBox=l("\069\100\105\116\066\111\120",nil,x.raidWindow,"\073\110\112\117\116\066\111\120\084\101\109\112\108\097\116\101")x.raidWindow.editBox:SetPoint("\084\079\080\076\069\070\084",x.raidWindow.otherText,"\066\079\084\084\079\077\076\069\070\084",0,-5)x.raidWindow.editBox:SetPoint("\082\073\071\072\084",-10,0)x.raidWindow.editBox:SetHeight(20)x.raidWindow.editBox:SetAutoFocus(false)x.raidWindow.editBox:SetScript("\079\110\084\101\120\116\067\104\097\110\103\101\100",function(i)if i:GetText()~=""then if x.saveSelectionEnabled then x.lastSelectionType="\111\116\104\101\114"x.lastOtherText=i:GetText()end x.raidWindow.selectedRaidId=nil x.raidWindow.selectedRaidName=nil u()end end)x.raidWindow.saveCheckbox=l("\067\104\101\099\107\066\117\116\116\111\110",nil,x.raidWindow,"\085\073\067\104\101\099\107\066\117\116\116\111\110\084\101\109\112\108\097\116\101")x.raidWindow.saveCheckbox:SetPoint("\084\079\080\076\069\070\084",x.raidWindow.editBox,"\066\079\084\084\079\077\076\069\070\084",0,-10)x.raidWindow.saveCheckbox:SetSize(24,24)x.raidWindow.saveCheckbox.text=x.raidWindow.saveCheckbox:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108")x.raidWindow.saveCheckbox.text:SetPoint("\076\069\070\084",x.raidWindow.saveCheckbox,"\082\073\071\072\084",5,0)x.raidWindow.saveCheckbox.text:SetText("\208\161\208\190\209\133\209\128\208\176\208\189\208\184\209\130\209\140 \208\178\209\139\208\177\208\190\209\128")x.raidWindow.saveCheckbox:SetChecked(true)x.saveSelectionEnabled=true x.raidWindow.saveCheckbox:SetScript("\079\110\067\108\105\099\107",function()x.saveSelectionEnabled=x.raidWindow.saveCheckbox:GetChecked()end)x.raidWindow.selectedPlayersText=x.raidWindow:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108\083\109\097\108\108")x.raidWindow.selectedPlayersText:SetPoint("\084\079\080\076\069\070\084",x.raidWindow.saveCheckbox,"\066\079\084\084\079\077\076\069\070\084",0,-5)x.raidWindow.selectedPlayersText:SetPoint("\082\073\071\072\084",-10,0)x.raidWindow.selectedPlayersText:SetHeight(70)x.raidWindow.selectedPlayersText:SetJustifyH("\076\069\070\084")x.raidWindow.selectedPlayersText:SetJustifyV("\084\079\080")x.raidWindow.selectedPlayersText:SetWordWrap(true)local S={5,10;20,25,50,100}local N for i,u in e(S)do local r=l("\066\117\116\116\111\110",nil,x.raidWindow,"\085\073\080\097\110\101\108\066\117\116\116\111\110\084\101\109\112\108\097\116\101")r:SetSize(27,20)r:SetText(tostring(u))if i==1 then r:SetPoint("\066\079\084\084\079\077\076\069\070\084",x.raidWindow.selectedPlayersText,"\066\079\084\084\079\077\076\069\070\084",0,-20)else r:SetPoint("\076\069\070\084",N,"\082\073\071\072\084",5,0)end r:SetScript("\079\110\067\108\105\099\107",function()local i=T(x.raidWindow.gpEditBox:GetText())or 0 x.raidWindow.gpEditBox:SetText(tostring(u))x.raidWindow.gpEditBox:HighlightText()end)N=r end local B=l("\066\117\116\116\111\110",nil,x.raidWindow,"\085\073\080\097\110\101\108\066\117\116\116\111\110\084\101\109\112\108\097\116\101")B:SetSize(40,22)B:SetText("-\047\043")B:SetPoint("\076\069\070\084",N,"\082\073\071\072\084",5,0)B:SetScript("\079\110\067\108\105\099\107",function()local i=T(x.raidWindow.gpEditBox:GetText())or 0 x.raidWindow.gpEditBox:SetText(tostring(-i))x.raidWindow.gpEditBox:HighlightText()end)x.raidWindow.gpEditBox=l("\069\100\105\116\066\111\120",nil,x.raidWindow,"\073\110\112\117\116\066\111\120\084\101\109\112\108\097\116\101")x.raidWindow.gpEditBox:SetPoint("\066\079\084\084\079\077\076\069\070\084",10,5)x.raidWindow.gpEditBox:SetSize(100,20)x.raidWindow.gpEditBox:SetAutoFocus(false)x.raidWindow.gpEditBox:SetScript("\079\110\069\115\099\097\112\101\080\114\101\115\115\101\100",function()x.raidWindow.gpEditBox:ClearFocus()end)x.raidWindow.gpEditBox:SetScript("\079\110\069\110\116\101\114\080\114\101\115\115\101\100",function()x.raidWindow.gpEditBox:ClearFocus()end)x.raidWindow.awardButton=l("\066\117\116\116\111\110",nil,x.raidWindow,"\085\073\080\097\110\101\108\066\117\116\116\111\110\084\101\109\112\108\097\116\101")x.raidWindow.awardButton:SetPoint("\066\079\084\084\079\077\082\073\071\072\084",-10,5)x.raidWindow.awardButton:SetSize(100,22)x.raidWindow.awardButton:SetText("\208\157\208\176\209\135\208\184\209\129\208\187\208\184\209\130\209\140")x.raidWindow.awardButton:SetScript("\079\110\067\108\105\099\107",function()if not x:_CheckOfficerRank()then print("\124\099\070\070\070\070\048\048\048\048\208\147\208\159\058\124\114 \208\162\208\190\208\187\209\140\208\186\208\190 \208\190\209\132\208\184\209\134\208\181\209\128\209\139 \208\188\208\190\208\179\209\131\209\130 \208\189\208\176\209\135\208\184\209\129\208\187\209\143\209\130\209\140 \208\147\208\159")x.raidWindow:Hide()return end if next(x.selected_indices)==nil then print("\124\099\070\070\070\070\048\048\048\048\208\147\208\159\058\124\114 \208\157\208\181\209\130 \208\178\209\139\208\180\208\181\208\187\208\181\208\189\208\189\209\139\209\133 \208\184\208\179\209\128\208\190\208\186\208\190\208\178")x.raidWindow:Hide()return end local u=T(x.raidWindow.gpEditBox:GetText())if not u then print("\124\099\070\070\070\070\048\048\048\048\208\147\208\159\058\124\114 \208\163\208\186\208\176\208\182\208\184\209\130\208\181 \208\183\208\189\208\176\209\135\208\181\208\189\208\184\208\181 \208\147\208\159")return end if not x.raidWindow.selectedRaidId and not(x.lastOtherText or""):match("\037\083")then print("\124\099\070\070\070\070\048\048\048\048\208\147\208\159\058\124\114 \208\157\209\131\208\182\208\189\208\190 \208\178\209\139\208\177\209\128\208\176\209\130\209\140 \209\128\208\181\208\185\208\180 \208\184\208\187\208\184 \209\131\208\186\208\176\208\183\208\176\209\130\209\140 \208\191\209\128\208\184\209\135\208\184\208\189\209\131")return end if not x.saveSelectionEnabled then x.lastSelectionType=nil x.lastRaidId=nil x.lastRaidName=nil x.lastRaidPlayers=0 x.lastOtherText=nil x.lastGPValue=0 else x.lastGPValue=u end local r if x.raidWindow.selectedRaidId then local i=(x.raidWindow.selectedRaidName or""):gsub("\037\115\043","\095")r=string.format("\037\048\052\100\095\037\115\095\037\100 \037\100",x.raidWindow.selectedRaidId,i,x.raidWindow.selectedRaidPlayers or 0,u)else local i=(x.lastOtherText or""):gsub("\037\115\043","\095")r=string.format("\037\115 \037\100",i,u)end for i in i(x.selected_indices)do if x.gp_data[i]then local l=x.gp_data[i].original_nick local T=x.gp_data[i].playerID or"\085\078\075\078\079\087\078"SendAddonMessage("\110\115\071\080"..(" "..u),l,"\103\117\105\108\100")r=r..(" "..T)x:AddLogEntry(u,date("\037\072\058\037\077"),UnitName("\112\108\097\121\101\114"),x.raidWindow.selectedRaidName or x.raidWindow.editBox:GetText(),l)end end SendAddonMessage("\110\115\071\080\108\111\103",r,"\103\117\105\108\100")for i,x in e(x:GetSelectedEntries())do x.gp=(x.gp or 0)+u end x:UpdateWindow()x.raidWindow:Hide()end)x.raidWindow:SetScript("\079\110\072\105\100\101",function()if x.logWindow and x.logWindow:IsShown()then x.logWindow:SetHeight(x.window:GetHeight())end end)x.raidWindow:Hide()end function GpDb._UpdateSelectedPlayersText(i)if not i.raidWindow then return end local x=i:GetSelectedEntries()local u={}for i,x in e(x)do table.insert(u,x.original_nick)end local r=table.concat(u,"\044 ")if not i.raidWindow.selectedPlayersText then i.raidWindow.selectedPlayersText=i.raidWindow:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108\083\109\097\108\108")i.raidWindow.selectedPlayersText:SetPoint("\084\079\080\076\069\070\084",i.raidWindow.saveCheckbox,"\066\079\084\084\079\077\076\069\070\084",0,-5)i.raidWindow.selectedPlayersText:SetPoint("\082\073\071\072\084",-10,0)i.raidWindow.selectedPlayersText:SetHeight(80)i.raidWindow.selectedPlayersText:SetJustifyH("\076\069\070\084")i.raidWindow.selectedPlayersText:SetJustifyV("\084\079\080")i.raidWindow.selectedPlayersText:SetWordWrap(true)i.raidWindow.selectedPlayersTextContainer=l("\070\114\097\109\101",nil,i.raidWindow)i.raidWindow.selectedPlayersTextContainer:SetAllPoints(i.raidWindow.selectedPlayersText)i.raidWindow.selectedPlayersTextContainer:SetScript("\079\110\069\110\116\101\114",function()if i.raidWindow.selectedPlayersText.tooltip then GameTooltip:SetOwner(i.raidWindow.selectedPlayersTextContainer,"\065\078\067\072\079\082\095\082\073\071\072\084")GameTooltip:SetText("\208\146\209\139\208\177\209\128\208\176\208\189\208\189\209\139\208\181 \208\184\208\179\209\128\208\190\208\186\208\184\058")GameTooltip:AddLine(i.raidWindow.selectedPlayersText.tooltip,1,1,1,true)GameTooltip:Show()end end)i.raidWindow.selectedPlayersTextContainer:SetScript("\079\110\076\101\097\118\101",function()GameTooltip:Hide()end)end if#r>60 then local x=string.sub(r,1,600).."\046\046\046"i.raidWindow.selectedPlayersText:SetText(x)i.raidWindow.selectedPlayersText.tooltip=r else i.raidWindow.selectedPlayersText:SetText(r)i.raidWindow.selectedPlayersText.tooltip=nil end end function GpDb.RestoreRaidWindowState(i)if not i.raidWindow then return end if i.lastSelectionType=="\114\097\105\100"and i.lastRaidId then UIDropDownMenu_SetText(i.raidWindow.dropdown,string.format("\037\100\058 \037\115",i.lastRaidId,i.lastRaidName))i.raidWindow.editBox:SetText("")i.raidWindow.selectedRaidId=i.lastRaidId i.raidWindow.selectedRaidName=i.lastRaidName i.raidWindow.selectedRaidPlayers=i.lastRaidPlayers elseif i.lastSelectionType=="\111\116\104\101\114"and i.lastOtherText then UIDropDownMenu_SetText(i.raidWindow.dropdown,"\208\146\209\139\208\177\208\181\209\128\208\184\209\130\208\181 \209\128\208\181\208\185\208\180")i.raidWindow.editBox:SetText(i.lastOtherText)i.raidWindow.selectedRaidId=nil i.raidWindow.selectedRaidName=nil else UIDropDownMenu_SetText(i.raidWindow.dropdown,"\208\146\209\139\208\177\208\181\209\128\208\184\209\130\208\181 \209\128\208\181\208\185\208\180")i.raidWindow.editBox:SetText("")i.raidWindow.selectedRaidId=nil i.raidWindow.selectedRaidName=nil end if not i.lastGPValue then i.lastGPValue=0 end i.raidWindow.gpEditBox:SetText(tostring(i.lastGPValue))i.raidWindow.saveCheckbox:SetChecked(i.saveSelectionEnabled)i:_UpdateSelectedPlayersText()end function GpDb._CheckOfficerRank(i)if not IsInGuild()then return false end local x=UnitName("\112\108\097\121\101\114")for i=1,GetNumGuildMembers(),1 do local u,r,l=GetGuildRosterInfo(i)if u and u==x then local i=GuildControlGetRankName(l+1)if i=="\208\154\208\176\208\191\208\184\209\130\208\176\208\189"or i=="\208\155\208\181\208\185\209\130\208\181\208\189\208\176\208\189\209\130"then return true end break end end return false end function GpDb.ToggleRaidWindow(i)if not i:_CheckOfficerRank()then print("\124\099\070\070\070\070\048\048\048\048\208\147\208\159\058\124\114 \208\162\208\190\208\187\209\140\208\186\208\190 \208\190\209\132\208\184\209\134\208\181\209\128\209\139 \208\188\208\190\208\179\209\131\209\130 \208\189\208\176\209\135\208\184\209\129\208\187\209\143\209\130\209\140 \208\147\208\159")if i.raidWindow and i.raidWindow:IsShown()then i.raidWindow:Hide()end return end if not i.raidWindow then i:_CreateRaidSelectionWindow()end local x=IsInRaid()local u=i.window.raidOnlyCheckbox:GetChecked()local r=next(i.selected_indices)~=nil if not r and not i.raidWindow:IsShown()then i.raidWindow:Show()UIDropDownMenu_Initialize(i.raidWindow.dropdown,nil)return end if r then if x and not u then print("\124\099\070\070\070\070\048\048\048\048\208\147\208\159\058\124\114 \208\148\208\187\209\143 \208\189\208\176\209\135\208\184\209\129\208\187\208\181\208\189\208\184\209\143 \208\147\208\159 \208\178 \209\128\208\181\208\185\208\180\208\181 \208\178\208\186\208\187\209\142\209\135\208\184\209\130\208\181 \'\208\162\208\190\208\187\209\140\208\186\208\190 \209\128\208\181\208\185\208\180\'")i.raidWindow:Hide()return end if i.raidWindow:IsShown()then i.raidWindow:Hide()else i.raidWindow:Show()UIDropDownMenu_Initialize(i.raidWindow.dropdown,nil)end end end create_table={}create_table.__index=create_table function create_table.new(r,i,x)local l=u({},r)if x then _G[i.."\095\112"]=_G[i.."\095\112"]or{}l.input_table_p=_G[i.."\095\112"]end _G[i]=_G[i]or{}l.input_table=_G[i]return l end function create_table.get_table(i)return i.input_table end function create_table.get_table_p(i)return i.input_table_p end ButtonManager={}ButtonManager.__index=ButtonManager function ButtonManager.new(B,i,x,r,T,S,e,N)local c=u({},ButtonManager)if e then c.frame=l("\066\117\116\116\111\110",i,x)c.frame:SetNormalTexture(e)c.frame:SetHighlightTexture(e)else c.frame=l("\066\117\116\116\111\110",i,x,"\085\073\080\097\110\101\108\066\117\116\116\111\110\084\101\109\112\108\097\116\101")end if not c.frame then print("\208\158\209\136\208\184\208\177\208\186\208\176\058 \208\189\208\181 \209\131\208\180\208\176\208\187\208\190\209\129\209\140 \209\129\208\190\208\183\208\180\208\176\209\130\209\140 \209\132\209\128\208\181\208\185\208\188 \208\186\208\189\208\190\208\191\208\186\208\184\033")return end c.frame:SetSize(r,T)c:SetText(S)if N then c:SetMovable(N)end return c end function ButtonManager.SetTexture(u,i,x)if i then u.frame:SetNormalTexture("\073\110\116\101\114\102\097\099\101\092\065\100\100\079\110\115\092\078\083\081\067\051\092\108\105\098\115\092"..(i.."\046\116\103\097"))end if x then u.frame:SetHighlightTexture("\073\110\116\101\114\102\097\099\101\092\065\100\100\079\110\115\092\078\083\081\067\051\092\108\105\098\115\092"..(x.."\046\116\103\097"))end end function ButtonManager.SetText(x,i)local u=x.frame:GetFontString()or x.frame:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\072\105\103\104\108\105\103\104\116")u:SetText(i)local r,l=x.frame:GetSize()local T=math.floor(l*.6)u:SetFont("\070\111\110\116\115\092\070\082\073\090\081\084\095\095\046\084\084\070",T,"\079\085\084\076\073\078\069","\077\079\078\079\067\072\082\079\077\069")while u:GetStringWidth()>r and T>6 do T=T-1 u:SetFont("\070\111\110\116\115\092\070\082\073\090\081\084\095\095\046\084\084\070",T,"\079\085\084\076\073\078\069","\077\079\078\079\067\072\082\079\077\069")end u:SetPoint("\067\069\078\084\069\082",x.frame,"\067\069\078\084\069\082",0,0)u:SetJustifyH("\067\069\078\084\069\082")u:SetJustifyV("\077\073\068\068\076\069")u:SetWordWrap(false)u:SetNonSpaceWrap(false)end function ButtonManager.SetTextT(u,i,x)local r=u.frame:GetFontString()if not r then r=u.frame:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\072\105\103\104\108\105\103\104\116")u.frame:SetFontString(r)end r:SetFont("\070\111\110\116\115\092\070\082\073\090\081\084\095\095\046\084\084\070",12,"\079\085\084\076\073\078\069","\077\079\078\079\067\072\082\079\077\069")r:SetText(i)local function l(i)i=i:gsub("\035","")local x=T("\048\120"..i:sub(1,2))/255 local u=T("\048\120"..i:sub(3,4))/255 local r=T("\048\120"..i:sub(5,6))/255 return x,u,r end if x==nil then local i,x,u=l("\070\070\056\067\048\048")r:SetTextColor(i,x,u)elseif type(x)=="\115\116\114\105\110\103"and x:match("\094\037\120\037\120\037\120\037\120\037\120\037\120\036")then local i,u,T=l(x)r:SetTextColor(i,u,T)elseif type(x)=="\116\097\098\108\101"then local i,u,l=unpack(x)r:SetTextColor(i,u,l)else r:SetTextColor(1,1,1)end end function ButtonManager.SetPosition(T,i,x,u,r,l)T.frame:SetPoint(i,x,u,r,l)end function ButtonManager.Hide(i)i.frame:Hide()end function ButtonManager.Show(i)i.frame:Show()end function ButtonManager.SetOnClick(x,i)x.frame:SetScript("\079\110\067\108\105\099\107",i)end function ButtonManager.SetOnEnter(x,i)local u=x.frame:GetScript("\079\110\069\110\116\101\114")x.frame:SetScript("\079\110\069\110\116\101\114",function(x,...)if u then u(x,...)end i(x,...)end)end function ButtonManager.SetOnLeave(x,i)local u=x.frame:GetScript("\079\110\076\101\097\118\101")x.frame:SetScript("\079\110\076\101\097\118\101",function(...)if u then u(...)end i(...)end)end function ButtonManager.SetTooltip(x,i)x.frame:SetScript("\079\110\069\110\116\101\114",function(x)GameTooltip:SetOwner(x,"\065\078\067\072\079\082\095\082\073\071\072\084")GameTooltip:SetText(i)GameTooltip:Show()end)x.frame:SetScript("\079\110\076\101\097\118\101",function()GameTooltip:Hide()end)end function ButtonManager.SetMultiLineTooltip(x,i)if type(i)~="\116\097\098\108\101"then return end local u=x.frame:GetScript("\079\110\069\110\116\101\114")local r=x.frame:GetScript("\079\110\076\101\097\118\101")x.frame:SetScript("\079\110\069\110\116\101\114",function(x,...)if u then u(x,...)end GameTooltip:SetOwner(x,"\065\078\067\072\079\082\095\082\073\071\072\084")for i,x in e(i)do GameTooltip:AddLine(x,1,1,1)end GameTooltip:Show()end)x.frame:SetScript("\079\110\076\101\097\118\101",function(...)if r then r(...)end GameTooltip:Hide()end)end function ButtonManager.SetSize(u,i,x)if u.frame then u.frame:SetWidth(i)u.frame:SetHeight(x)else print("\208\158\209\136\208\184\208\177\208\186\208\176\058 \209\132\209\128\208\181\208\185\208\188 \208\186\208\189\208\190\208\191\208\186\208\184 \208\189\208\181 \209\129\209\131\209\137\208\181\209\129\209\130\208\178\209\131\208\181\209\130\033")end end function ButtonManager.SetPoint(T,i,x,u,r,l)if T.frame then T.frame:SetPoint(i,x,u,r,l)else print("\208\158\209\136\208\184\208\177\208\186\208\176\058 \209\132\209\128\208\181\208\185\208\188 \208\186\208\189\208\190\208\191\208\186\208\184 \208\189\208\181 \209\129\209\131\209\137\208\181\209\129\209\130\208\178\209\131\208\181\209\130\033")end end function ButtonManager.Hide(i)if i.frame then i.frame:Hide()else print("\208\158\209\136\208\184\208\177\208\186\208\176\058 \209\132\209\128\208\181\208\185\208\188 \208\186\208\189\208\190\208\191\208\186\208\184 \208\189\208\181 \209\129\209\131\209\137\208\181\209\129\209\130\208\178\209\131\208\181\209\130\033")end end function ButtonManager.Show(i)if i.frame then i.frame:Show()else print("\208\158\209\136\208\184\208\177\208\186\208\176\058 \209\132\209\128\208\181\208\185\208\188 \208\186\208\189\208\190\208\191\208\186\208\184 \208\189\208\181 \209\129\209\131\209\137\208\181\209\129\209\130\208\178\209\131\208\181\209\130\033")end end function ButtonManager.GetTxt(x,i)local u if i=="\078"then u=x.frame:GetNormalTexture()elseif i=="\080"then u=x.frame:GetPushedTexture()elseif i=="\072"then u=x.frame:GetHighlightTexture()else return"\208\157\208\181\208\178\208\181\209\128\208\189\209\139\208\185 \209\130\208\184\208\191 \209\130\208\181\208\186\209\129\209\130\209\131\209\128\209\139\046"end if u then local i=u:GetTexture()if i then return i:sub(-3)else return"\208\162\208\181\208\186\209\129\209\130\209\131\209\128\208\176 \208\189\208\181 \209\131\209\129\209\130\208\176\208\189\208\190\208\178\208\187\208\181\208\189\208\176\046"end else return"\208\162\208\181\208\186\209\129\209\130\209\131\209\128\208\176 \208\189\208\181 \209\131\209\129\209\130\208\176\208\189\208\190\208\178\208\187\208\181\208\189\208\176\046"end end function ButtonManager.SetMovable(x,i)if i then x.frame:SetMovable(true)x.frame:RegisterForDrag("\076\101\102\116\066\117\116\116\111\110")x.frame:SetScript("\079\110\068\114\097\103\083\116\097\114\116",function(i)i:StartMoving()end)x.frame:SetScript("\079\110\068\114\097\103\083\116\111\112",function(i)i:StopMovingOrSizing()end)else x.frame:SetMovable(false)x.frame:RegisterForDrag(nil)x.frame:SetScript("\079\110\068\114\097\103\083\116\097\114\116",nil)x.frame:SetScript("\079\110\068\114\097\103\083\116\111\112",nil)end end local C=32 local O=15 local d=-40 local H=200 local h=200 local w=0 local m=40 local M=0 local W=0 local G=1 AdaptiveFrame={}AdaptiveFrame.__index=AdaptiveFrame function AdaptiveFrame.new(x,i)local r=u({},AdaptiveFrame)r.parent=i or UIParent r.width=600 r.height=600 r.initialAspectRatio=r.width/r.height r.buttonsPerRow=5 r.skipSizeCheck=true r.frame=l("\070\114\097\109\101","\065\100\097\112\116\105\118\101\070\114\097\109\101\095"..math.random(10000),r.parent)r.frame:SetSize(r.width,r.height)r.skipSizeCheck=false r.frame:SetPoint("\067\069\078\084\069\082",r.parent,"\067\069\078\084\069\082",150,100)r.frame:SetFrameStrata("\072\073\071\072")r.frame:SetBackdrop({bgFile="\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\087\072\073\084\069\056\120\056";edgeFile="\073\110\116\101\114\102\097\099\101\092\084\111\111\108\116\105\112\115\092\085\073-\084\111\111\108\116\105\112-\066\111\114\100\101\114";tile=true;tileSize=16,edgeSize=16,insets={left=4;right=4,top=4;bottom=4}})W=ns_dbc:getKey("\208\189\208\176\209\129\209\130\209\128\208\190\208\185\208\186\208\184","\070\082\065\077\069\095\065\076\080\072\065")or W G=ns_dbc:getKey("\208\189\208\176\209\129\209\130\209\128\208\190\208\185\208\186\208\184","\066\085\084\084\079\078\095\065\076\080\072\065")or G r.frame:SetBackdropColor(.1,.1,.1,W)r.frame:SetBackdropBorderColor(.8,.8,.8,0)r.textField=r.frame:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\072\105\103\104\108\105\103\104\116")r.textField:SetPoint("\084\079\080",r.frame,"\084\079\080",0,-5)r.textField:SetText("")r.textField:SetTextColor(1,1,1,1)r.frame:SetMovable(true)r.frame:SetResizable(true)r.frame:EnableMouse(true)r.frame:RegisterForDrag("\076\101\102\116\066\117\116\116\111\110","\082\105\103\104\116\066\117\116\116\111\110")r.frame:SetScript("\079\110\077\111\117\115\101\068\111\119\110",function(i,x)if x=="\082\105\103\104\116\066\117\116\116\111\110"then r:ToggleFrameAlpha()elseif x=="\076\101\102\116\066\117\116\116\111\110"then r:StartMoving()end end)local T=0 local S=false r.frame:SetScript("\079\110\077\111\117\115\101\085\112",function(i,x)if x=="\082\105\103\104\116\066\117\116\116\111\110"then S=false r.frame:SetScript("\079\110\085\112\100\097\116\101",nil)else r:StopMovingOrSizing()end end)r.frame:SetScript("\079\110\068\114\097\103\083\116\097\114\116",function(i,x)if x=="\082\105\103\104\116\066\117\116\116\111\110"then T=GetCursorPosition()S=true r.frame:SetScript("\079\110\085\112\100\097\116\101",function()if S then local i=GetCursorPosition()local x=i-T T=i for i,u in e(r.children)do local r=u.frame:GetAlpha()if x>0 then local i=math.min(r+math.abs(x)/1000,1)u.frame:SetAlpha(i)ns_dbc:modKey("\208\189\208\176\209\129\209\130\209\128\208\190\208\185\208\186\208\184","\066\085\084\084\079\078\095\065\076\080\072\065",i)G=i elseif x<0 then local i=math.max(r-math.abs(x)/1000,0)u.frame:SetAlpha(i)ns_dbc:modKey("\208\189\208\176\209\129\209\130\209\128\208\190\208\185\208\186\208\184","\066\085\084\084\079\078\095\065\076\080\072\065",i)G=i end end end end)else r:StartMoving()end end)r.frame:SetScript("\079\110\068\114\097\103\083\116\111\112",function(i,x)if x=="\082\105\103\104\116\066\117\116\116\111\110"then S=false r.frame:SetScript("\079\110\085\112\100\097\116\101",nil)else r:StopMovingOrSizing()end end)r.closeButton=l("\066\117\116\116\111\110",nil,r.frame,"\085\073\080\097\110\101\108\067\108\111\115\101\066\117\116\116\111\110")r.closeButton:SetSize(C,C)r.closeButton:SetPoint("\084\079\080\082\073\071\072\084",r.frame,"\084\079\080\082\073\071\072\084",-O+5,-O)r.closeButton:SetScript("\079\110\067\108\105\099\107",function()r:Hide()for i=1,100,1 do if r.children[i]then r.children[i]:SetTextT("")end end end)r.toggleSideButton=l("\066\117\116\116\111\110",nil,r.frame)r.toggleSideButton:SetSize(C,C)r.toggleSideButton:SetPoint("\084\079\080\082\073\071\072\084",r.closeButton,"\066\079\084\084\079\077\082\073\071\072\084",5,-5)r.toggleSideButton:SetNormalTexture("\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\085\073-\083\112\101\108\108\098\111\111\107\073\099\111\110-\078\101\120\116\080\097\103\101-\085\112");(r.toggleSideButton:GetNormalTexture()):SetDesaturated(true)r.toggleSideButton:SetPushedTexture("\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\085\073-\083\112\101\108\108\098\111\111\107\073\099\111\110-\078\101\120\116\080\097\103\101-\068\111\119\110")r.toggleSideButton:SetHighlightTexture("\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\085\073-\067\111\109\109\111\110-\077\111\117\115\101\072\105\108\105\103\104\116")r.toggleSideButton:SetScript("\079\110\067\108\105\099\107",function()if not r.sideFrame then r:CreateSideFrame()r:ShowSideFrame();(r.toggleSideButton:GetNormalTexture()):SetTexture("\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\085\073-\083\112\101\108\108\098\111\111\107\073\099\111\110-\080\114\101\118\080\097\103\101-\085\112");(r.toggleSideButton:GetPushedTexture()):SetTexture("\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\085\073-\083\112\101\108\108\098\111\111\107\073\099\111\110-\080\114\101\118\080\097\103\101-\068\111\119\110")elseif r.sideFrame:IsShown()then r:HideSideFrame();(r.toggleSideButton:GetNormalTexture()):SetTexture("\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\085\073-\083\112\101\108\108\098\111\111\107\073\099\111\110-\078\101\120\116\080\097\103\101-\085\112");(r.toggleSideButton:GetPushedTexture()):SetTexture("\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\085\073-\083\112\101\108\108\098\111\111\107\073\099\111\110-\078\101\120\116\080\097\103\101-\068\111\119\110")else r:ShowSideFrame();(r.toggleSideButton:GetNormalTexture()):SetTexture("\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\085\073-\083\112\101\108\108\098\111\111\107\073\099\111\110-\080\114\101\118\080\097\103\101-\085\112");(r.toggleSideButton:GetPushedTexture()):SetTexture("\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\085\073-\083\112\101\108\108\098\111\111\107\073\099\111\110-\080\114\101\118\080\097\103\101-\068\111\119\110")end end)r.toggleSideButton:SetScript("\079\110\069\110\116\101\114",function()GameTooltip:SetOwner(r.toggleSideButton,"\065\078\067\072\079\082\095\082\073\071\072\084")GameTooltip:SetText("\208\159\208\190\208\186\208\176\208\183\208\176\209\130\209\140\047\209\129\208\186\209\128\209\139\209\130\209\140 \208\184\208\189\208\178\208\181\208\189\209\130\208\176\209\128\209\140")GameTooltip:Show()end)r.toggleSideButton:SetScript("\079\110\076\101\097\118\101",function()GameTooltip:Hide()end)r.resizeHandle=l("\066\117\116\116\111\110",nil,r.frame)r.resizeHandle:SetSize(16,16)r.resizeHandle:SetPoint("\066\079\084\084\079\077\082\073\071\072\084",r.frame,"\066\079\084\084\079\077\082\073\071\072\084",-40,40)r.resizeHandle:SetNormalTexture("\073\110\116\101\114\102\097\099\101\092\067\104\097\116\070\114\097\109\101\092\085\073-\067\104\097\116\073\077-\083\105\122\101\071\114\097\098\098\101\114-\085\112")r.resizeHandle:SetHighlightTexture("\073\110\116\101\114\102\097\099\101\092\067\104\097\116\070\114\097\109\101\092\085\073-\067\104\097\116\073\077-\083\105\122\101\071\114\097\098\098\101\114-\072\105\103\104\108\105\103\104\116")r.resizeHandle:SetPushedTexture("\073\110\116\101\114\102\097\099\101\092\067\104\097\116\070\114\097\109\101\092\085\073-\067\104\097\116\073\077-\083\105\122\101\071\114\097\098\098\101\114-\068\111\119\110")r.resizeHandle:SetScript("\079\110\077\111\117\115\101\068\111\119\110",function()r.frame:StartSizing("\066\079\084\084\079\077\082\073\071\072\084")end)r.resizeHandle:SetScript("\079\110\077\111\117\115\101\085\112",function()r.frame:StopMovingOrSizing()local i,x=r:GetSize()ns_dbc:modKey("\208\189\208\176\209\129\209\130\209\128\208\190\208\185\208\186\208\184","\109\102\108\100\082\088",i)r:AdjustSizeAndPosition()end)r.frame:SetScript("\079\110\083\105\122\101\067\104\097\110\103\101\100",function(i,x,u)if r.skipSizeCheck then r.skipSizeCheck=false return end x,u=r:CheckFrameSize(x,u)r.frame:SetSize(x,u)r:AdjustSizeAndPosition()end)r.children={}return r end function AdaptiveFrame.SetText(x,i)if x.textField then x.textField:SetText(i)else print("\208\158\209\136\208\184\208\177\208\186\208\176\058 \208\162\208\181\208\186\209\129\209\130\208\190\208\178\208\190\208\181 \208\191\208\190\208\187\208\181 \208\189\208\181 \208\184\208\189\208\184\209\134\208\184\208\176\208\187\208\184\208\183\208\184\209\128\208\190\208\178\208\176\208\189\208\190\046")end end function AdaptiveFrame.ToggleFrameAlpha(i)local x=select(4,i.frame:GetBackdropColor())W=ns_dbc:getKey("\208\189\208\176\209\129\209\130\209\128\208\190\208\185\208\186\208\184","\070\082\065\077\069\095\065\076\080\072\065")or W if not ns_dbc:getKey("\208\189\208\176\209\129\209\130\209\128\208\190\208\185\208\186\208\184","\102\117\108\108\065\108\112\104\097\070\114\097\109\101")then if W~=0 then if x>W-.05 then i.frame:SetBackdropColor(.1,.1,.1,0)elseif x==0 then i.frame:SetBackdropColor(.1,.1,.1,W)end else if x>.1 then i.frame:SetBackdropColor(.1,.1,.1,0)elseif x==0 then i.frame:SetBackdropColor(.1,.1,.1,1)end end end end function AdaptiveFrame.StartMoving(i)i.frame:StartMoving()end function AdaptiveFrame.StopMovingOrSizing(i)i.frame:StopMovingOrSizing()local x,u=i:GetPosition()ns_dbc:modKey("\208\189\208\176\209\129\209\130\209\128\208\190\208\185\208\186\208\184","\109\102\108\100\088",x)ns_dbc:modKey("\208\189\208\176\209\129\209\130\209\128\208\190\208\185\208\186\208\184","\109\102\108\100\089",u)i:AdjustSizeAndPosition()end function AdaptiveFrame.Hide(i)i.frame:Hide()end function AdaptiveFrame.Show(i)i.frame:Show()i:AdjustSizeAndPosition()end function AdaptiveFrame.GetSize(i)local x,u=i.frame:GetSize()return x,u end function AdaptiveFrame.CheckFrameSize(u,i,x)local r,l=WorldFrame:GetWidth(),WorldFrame:GetHeight()local T=l+200 local S=h if x>T then x=T end if x<S then x=S end return x,x end function AdaptiveFrame.AdjustSizeAndPosition(i)local x=10 local u=#i.children local r=math.ceil(u/x)local l,T=i.frame:GetSize()local S=((l-2*m)-(x-1)*w)/x local N=S local B=(2*m+x*S)+(x-1)*w local c=(2*m+r*N)+(r-1)*w if l<B or T<c then i.frame:SetSize(B,c)l,T=B,c S=((l-2*m)-(x-1)*w)/x N=S end for u,r in e(i.children)do local l=math.floor((u-1)/x)local T=(u-1)%x local e=m+T*(S+w)local B=m+l*(N+w)if ButtonManager.SetSize and ButtonManager.SetPoint then ButtonManager.SetSize(r,S,N)ButtonManager.SetPoint(r,"\066\079\084\084\079\077\076\069\070\084",i.frame,"\066\079\084\084\079\077\076\069\070\084",e,B)else print("\069\114\114\111\114\058 \067\104\105\108\100 \100\111\101\115 \110\111\116 \115\117\112\112\111\114\116 \114\101\113\117\105\114\101\100 \109\101\116\104\111\100\115")end end local b,o=UIParent:GetSize()local z,s=i.frame:GetLeft(),i.frame:GetBottom()d=ns_dbc:getKey("\208\189\208\176\209\129\209\130\209\128\208\190\208\185\208\186\208\184","\083\067\082\069\069\078\095\080\065\068\068\073\078\071")or d z=math.max(d,math.min(z,(b-l)-d))s=math.max(d,math.min(s,(o-T)-d))i.frame:ClearAllPoints()i.frame:SetPoint("\066\079\084\084\079\077\076\069\070\084",UIParent,"\066\079\084\084\079\077\076\069\070\084",z,s)end function AdaptiveFrame.AddButtons(T,i,x,u,r,l)T.buttonsPerRow=x or T.buttonsPerRow local S=u local e=u local N=r local B=l local c=""for i=1,i,1 do local x="\098\117\116\116\111\110"..i local u=ButtonManager:new(x,T.frame,S,e,c,"",nil)u.frame:RegisterForClicks("\076\101\102\116\066\117\116\116\111\110\085\112","\076\101\102\116\066\117\116\116\111\110\068\111\119\110","\082\105\103\104\116\066\117\116\116\111\110\085\112","\082\105\103\104\116\066\117\116\116\111\110\068\111\119\110","\077\105\100\100\108\101\066\117\116\116\111\110\068\111\119\110","\066\117\116\116\111\110\052\085\112","\066\117\116\116\111\110\053\085\112","\066\117\116\116\111\110\053\068\111\119\110")u.frame:EnableMouseWheel(true)u.frame:SetAlpha(G)table.insert(T.children,u)end T:AdjustSizeAndPosition()end function AdaptiveFrame.StartMovementAlphaTracking(i)if i.movementFrame then return end local x=l("\070\114\097\109\101")i.movementFrame=x x.parent=i M=ns_dbc:getKey("\208\189\208\176\209\129\209\130\209\128\208\190\208\185\208\186\208\184","\077\079\086\069\095\065\076\080\072\065")or M x.targetAlpha=M x.currentAlpha=G x.alphaSpeed=2 x.BUTTON_ALPHA=G x:SetScript("\079\110\085\112\100\097\116\101",function(i,x)local u=GetUnitSpeed("\112\108\097\121\101\114")>0 local r=false if u then i.targetAlpha=M if ns_dbc:getKey("\208\189\208\176\209\129\209\130\209\128\208\190\208\185\208\186\208\184","\100\105\115\097\098\108\101\070\108\100")then i.parent.frame:EnableMouse(i.targetAlpha>M+.1)end r=true else i.targetAlpha=i.BUTTON_ALPHA r=true end if r and math.abs(i.currentAlpha-i.targetAlpha)>.01 then i.currentAlpha=i.currentAlpha+((i.targetAlpha-i.currentAlpha)*i.alphaSpeed)*x i.currentAlpha=math.min(math.max(i.currentAlpha,0),1)for x,u in e(i.parent.children)do if u.frame and u.frame.SetAlpha then u.frame:SetAlpha(i.currentAlpha)if ns_dbc:getKey("\208\189\208\176\209\129\209\130\209\128\208\190\208\185\208\186\208\184","\100\105\115\097\098\108\101\070\108\100")then u.frame:EnableMouse(i.currentAlpha>M+.1)end if i.currentAlpha<M+.1 then if ns_dbc:getKey("\208\189\208\176\209\129\209\130\209\128\208\190\208\185\208\186\208\184","\099\108\111\115\101\070\108\100")then i.parent:Hide()end end end end end if not u and math.abs(i.currentAlpha-i.targetAlpha)<.01 then i.currentAlpha=G i.parent.frame:EnableMouse(true)i.parent.frame:StopMovingOrSizing()i.parent:StopMovementAlphaTracking()end end)end function AdaptiveFrame.getTexture(x,i)return((x.children[i].frame:GetNormalTexture()):GetTexture()):sub(-3)end function AdaptiveFrame.StopMovementAlphaTracking(i)if i.movementFrame then i.movementFrame:SetScript("\079\110\085\112\100\097\116\101",nil)i.movementFrame=nil end end function AdaptiveFrame.GetPosition(i)return i.frame:GetCenter()end function AdaptiveFrame.SetPoint(u,i,x)u.frame:ClearAllPoints()u.frame:SetPoint("\067\069\078\084\069\082",UIParent,"\066\079\084\084\079\077\076\069\070\084",i,x)end function AdaptiveFrame.isVisible(i)if not i.frame then return false end return i.frame:IsVisible()end function AdaptiveFrame.CreateSideFrame(i)if i.sideFrame then return end i.sideTextHeight=15 i.sideTextPadding=5 i.scrollBarWidth=16 i.framePadding=10 i.textExtraSpace=500 i.sideFrame=l("\070\114\097\109\101","\077\121\065\100\100\111\110\083\105\100\101\070\114\097\109\101",i.frame)i.sideFrame:SetFrameStrata("\072\073\071\072")i.sideFrame:SetBackdrop({bgFile="\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\087\072\073\084\069\056\120\056";edgeFile="\073\110\116\101\114\102\097\099\101\092\084\111\111\108\116\105\112\115\092\085\073-\084\111\111\108\116\105\112-\066\111\114\100\101\114",tile=true,tileSize=16,edgeSize=16,insets={left=i.framePadding,right=i.framePadding;top=i.framePadding,bottom=i.framePadding}})i.sideFrame:SetBackdropColor(0,0,0,1)i.sideFrame:SetBackdropBorderColor(.8,.8,.8,.6)i.sideScrollFrame=l("\083\099\114\111\108\108\070\114\097\109\101","\077\121\065\100\100\111\110\083\099\114\111\108\108\070\114\097\109\101",i.sideFrame,"\085\073\080\097\110\101\108\083\099\114\111\108\108\070\114\097\109\101\084\101\109\112\108\097\116\101")i.sideScrollFrame:SetPoint("\084\079\080\076\069\070\084",i.framePadding,-i.framePadding)i.sideScrollFrame:SetPoint("\066\079\084\084\079\077\082\073\071\072\084",-i.scrollBarWidth-i.framePadding,i.framePadding)i.sideContent=l("\070\114\097\109\101",nil,i.sideScrollFrame)i.sideContent:SetSize(100,100)i.sideScrollFrame:SetScrollChild(i.sideContent)i.sideScrollBar=_G[i.sideScrollFrame:GetName().."\083\099\114\111\108\108\066\097\114"]i.sideScrollBar.scrollStep=i.sideTextHeight+i.sideTextPadding i.sideTextLines={}i:HideSideFrame()end function AdaptiveFrame.UpdateSideFrame(i)if not i.sideFrame or not i.sideFrame:IsShown()then return end local x,u=i.frame:GetSize()local r=0 local l=40 for i,x in e(i.sideTextLines)do x.text:SetWidth(0)local u=x.text:GetStringWidth()r=math.max(r,u)end r=r+30 local T=r+l local S=math.max(100,T)i.sideFrame:SetSize(S,u)i.sideFrame:SetPoint("\076\069\070\084",i.frame,"\082\073\071\072\084",5,0)local N=#i.sideTextLines*(i.sideTextHeight+i.sideTextPadding)local B=i.sideScrollFrame:GetHeight()i.sideContent:SetSize(S,math.max(N,B))i.sideScrollBar:SetMinMaxValues(0,math.max(0,N-B))for x,u in e(i.sideTextLines)do u:ClearAllPoints()u:SetWidth(S-20)u:SetHeight(i.sideTextHeight)local r=-(x-1)*(i.sideTextHeight+i.sideTextPadding)u:SetPoint("\084\079\080\076\069\070\084",i.sideContent,"\084\079\080\076\069\070\084",10,r)u.text:SetWidth(S-30)u.text:SetPoint("\076\069\070\084",u,"\076\069\070\084",5,0)end end function AdaptiveFrame.RemoveSideText(x,i)if not x.sideFrame or not x.sideTextLines then return 0 end local u=0 i=(i:gsub("\037\040\037\100\043\037\041\036","")):trim()for r=#x.sideTextLines,1,-1 do local l=x.sideTextLines[r].text:GetText()local T=(l:gsub("\037\040\037\100\043\037\041\036","")):trim()if T==i then x.sideTextLines[r]:Hide()table.remove(x.sideTextLines,r)u=u+1 end end if u>0 then x:UpdateSideFrame()end return u end function AdaptiveFrame.AddSideText(x,i)if not x.sideFrame then x:CreateSideFrame()end local u=(i:gsub("\037\040\037\100\043\037\041\036","")):trim()local r=0 local S=-1 for i,x in e(x.sideTextLines)do local l=x.text:GetText()local e=(l:gsub("\037\040\037\100\043\037\041\036","")):trim()if e==u then local x=T(l:match("\037\040\040\037\100\043\041\037\041\036"))or 1 if x>r then r=x S=i end end end if S~=-1 then local i=x.sideTextLines[S]local l=r+1 local T=u..("\040"..(l.."\041"))i.text:SetText(T)x:UpdateSideFrame()return end local N=l("\070\114\097\109\101",nil,x.sideContent)N:SetSize(100,x.sideTextHeight)local B=N:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108")B:SetPoint("\076\069\070\084",N,"\076\069\070\084",0,0)B:SetJustifyH("\076\069\070\084")B:SetText(i)B:SetTextColor(1,1,1,1)B:SetHeight(x.sideTextHeight)N:EnableMouse(true)N:SetScript("\079\110\077\111\117\115\101\068\111\119\110",function(i,u)if u=="\076\101\102\116\066\117\116\116\111\110"then x:MoveLineUp(N)elseif u=="\082\105\103\104\116\066\117\116\116\111\110"then x:ShowDeleteConfirmation(N)end end)N.text=B table.insert(x.sideTextLines,N)x:UpdateSideFrame()end function AdaptiveFrame.ParseExistingText(x,i)if not i then return nil,nil end local u,r=i:match("\094\040\046-\041\037\040\040\037\100\043\041\037\041\036")if u and r then return u:trim(),T(r)end return i:trim(),1 end function AdaptiveFrame.MoveLineUp(x,i)for u,r in e(x.sideTextLines)do if r==i and u>1 then x.sideTextLines[u],x.sideTextLines[u-1]=x.sideTextLines[u-1],x.sideTextLines[u]local r=i.text:GetText()i.text:SetText(x.sideTextLines[u-1].text:GetText())x.sideTextLines[u-1].text:SetText(r)x:UpdateSideFrame()break end end end function AdaptiveFrame.ShowDeleteConfirmation(x,i)local u=i.text:GetText()StaticPopupDialogs.CONFIRM_DELETE_LINE={text="\208\146\209\139 \209\133\208\190\209\130\208\184\209\130\208\181 \209\131\208\180\208\176\208\187\208\184\209\130\209\140 \""..(u.."\"\063"),button1="\208\148\208\176";button2="\208\157\208\181\209\130",OnAccept=function()x:DeleteLine(i)end,timeout=0;whileDead=true;hideOnEscape=true;preferredIndex=3}StaticPopup_Show("\067\079\078\070\073\082\077\095\068\069\076\069\084\069\095\076\073\078\069")end function AdaptiveFrame.DeleteLine(x,i)for u,r in e(x.sideTextLines)do if r==i then r:Hide()r:SetParent(nil)table.remove(x.sideTextLines,u)x:UpdateSideFrame()break end end end function AdaptiveFrame.ShowSideFrame(i)if not i.sideFrame then i:CreateSideFrame()end i.sideFrame:Show()i:UpdateSideFrame()end function AdaptiveFrame.HideSideFrame(i)if i.sideFrame then i.sideFrame:Hide()end end PopupPanel={}PopupPanel.__index=PopupPanel function PopupPanel.Create(T,i,x,r,l)local S=u({},PopupPanel)S.buttonWidth=i S.buttonHeight=x S.buttonsPerRow=r S.spacing=l or 0 S.buttons={}return S end function PopupPanel.CreateButtons(x,i)if not x.panel then error("\208\161\208\189\208\176\209\135\208\176\208\187\208\176 \208\178\209\139\208\183\208\190\208\178\208\184\209\130\208\181 \083\104\111\119\040\041 \208\180\208\187\209\143 \209\129\208\190\208\183\208\180\208\176\208\189\208\184\209\143 \208\191\208\176\208\189\208\181\208\187\208\184\046")end for i,x in e(x.buttons)do x:SetParent(nil)x:Hide()x:SetScript("\079\110\067\108\105\099\107",nil)x:SetScript("\079\110\069\110\116\101\114",nil)x:SetScript("\079\110\076\101\097\118\101",nil)end x.buttons={}local u=#i if u==0 then return end local r=math.min(u,x.buttonsPerRow)local T=r*x.buttonWidth+(r-1)*x.spacing local S=math.ceil(u/x.buttonsPerRow)*(x.buttonHeight+x.spacing)x.panel:SetSize(T,S)for i,u in e(i)do local r=l("\066\117\116\116\111\110",nil,x.panel)r:SetSize(x.buttonWidth,x.buttonHeight)r:SetFrameStrata("\068\073\065\076\079\071")local S=math.floor((i-1)/x.buttonsPerRow)local e=(i-1)%x.buttonsPerRow local N=(e*(x.buttonWidth+x.spacing)-T/2)+x.buttonWidth/2 local B=-S*(x.buttonHeight+x.spacing)r:SetPoint("\067\069\078\084\069\082",x.panel,"\067\069\078\084\069\082",N,B)r:SetNormalTexture(u.texture)r:SetHighlightTexture(u.texture)r:SetScript("\079\110\067\108\105\099\107",u.func)r:SetScript("\079\110\069\110\116\101\114",function()x.panel:Show()if u.tooltip then GameTooltip:SetOwner(r,"\065\078\067\072\079\082\095\082\073\071\072\084")GameTooltip:SetText(u.tooltip)GameTooltip:SetWidth(500)GameTooltip:Show()end end)r:SetScript("\079\110\076\101\097\118\101",function()GameTooltip:Hide()if not x.panel:IsMouseOver()then x.panel:Hide()end end)table.insert(x.buttons,r)end end function PopupPanel.Show(u,i,x)if not u.panel then u.panel=l("\070\114\097\109\101",nil,UIParent)u.panel:SetBackdrop({bgFile="\073\110\116\101\114\102\097\099\101\092\068\105\097\108\111\103\070\114\097\109\101\092\085\073-\068\105\097\108\111\103\066\111\120-\066\097\099\107\103\114\111\117\110\100"})u.panel:SetBackdropColor(0,0,0,.8)u.panel:Hide()end u.parentButton=i local function r()u.panel:ClearAllPoints()u.panel:SetPoint("\066\079\084\084\079\077",i,"\084\079\080",0,0)end i:SetScript("\079\110\069\110\116\101\114",function()local l={}for x,u in e(x)do local r,T=u(i)if r then for i,x in e(T)do table.insert(l,x)end end end if#l>0 then u:CreateButtons(l)r()u.panel:Show()end end)i:SetScript("\079\110\076\101\097\118\101",function()u.panel:Hide()end)u.panel:SetScript("\079\110\076\101\097\118\101",function()u.panel:Hide()end)end mDB={}mDB.__index=mDB function mDB.new(i)local x=u({},i)local r=u({getArg=function(i,u)return x[u]end,setArg=function(i,u,r)if r==nil then x[u]=nil else x[u]=r end end},i)r.private=x return r end UniversalInfoFrame={}UniversalInfoFrame.__index=UniversalInfoFrame function UniversalInfoFrame.new(r,i,x)local T,S=x:match("\094\040\091\037\119\095\093\043\041\037\091\'\063\"\063\040\091\094\'\"\093\043\041\091\'\"\093\063\037\093\036")if not T or not S then error("\208\157\208\181\208\178\208\181\209\128\208\189\209\139\208\185 \209\132\208\190\209\128\208\188\208\176\209\130 \208\191\209\131\209\130\208\184 \208\186 \209\130\208\176\208\177\208\187\208\184\209\134\208\181\058 "..tostring(saveTablePath))end local N=_G[T]if type(N)~="\116\097\098\108\101"then error("\208\162\208\176\208\177\208\187\208\184\209\134\208\176 "..(T.." \208\189\208\181 \209\129\209\131\209\137\208\181\209\129\209\130\208\178\209\131\208\181\209\130"))end if type(N[S])~="\116\097\098\108\101"then N[S]={}end local B=u({},r)r.__index=r B.saveTable=N[S]B.textsTop={}B.textsBottom={}B.updateInterval=i or 1 B.timeElapsed=0 B.isCollapsed=false B.collapsedText=nil B.frame=l("\070\114\097\109\101",nil,UIParent)B.frame:SetSize(200,50)if B.saveTable.x and B.saveTable.y then B.frame:SetPoint("\084\079\080\076\069\070\084",UIParent,"\066\079\084\084\079\077\076\069\070\084",B.saveTable.x,B.saveTable.y)else B.frame:SetPoint("\067\069\078\084\069\082")local i=B.frame:GetLeft()local x=B.frame:GetBottom()+B.frame:GetHeight()B.saveTable.x=i B.saveTable.y=x end B.frame:SetMovable(true)B.frame:EnableMouse(true)B.frame:RegisterForDrag("\076\101\102\116\066\117\116\116\111\110")B.frame:SetScript("\079\110\068\114\097\103\083\116\097\114\116",B.frame.StartMoving)B.frame:SetScript("\079\110\068\114\097\103\083\116\111\112",function()B.frame:StopMovingOrSizing()local i=B.frame:GetLeft()local x=B.frame:GetBottom()+B.frame:GetHeight()B.saveTable.x=i B.saveTable.y=x end)B.frame:SetBackdrop({bgFile="\073\110\116\101\114\102\097\099\101\092\084\111\111\108\116\105\112\115\092\085\073-\084\111\111\108\116\105\112-\066\097\099\107\103\114\111\117\110\100";edgeFile="\073\110\116\101\114\102\097\099\101\092\084\111\111\108\116\105\112\115\092\085\073-\084\111\111\108\116\105\112-\066\111\114\100\101\114",tile=true;tileSize=16;edgeSize=16,insets={left=4;right=4,top=4;bottom=4}})B.frame:SetBackdropColor(0,0,0,.8)B.frame:SetScript("\079\110\085\112\100\097\116\101",function(i,x)B:OnUpdate(x)end)B.frame:SetScript("\079\110\082\101\099\101\105\118\101\068\114\097\103",function()B:OnReceiveDrag()end)for i,x in e(B.saveTable)do if x.description then x.valueFunc=x.valueFunc or function()return"\078\047\065"end x.addToTop=x.addToTop==nil and true or x.addToTop B:AddText(x.description,x.valueFunc,x.addToTop,true)end end return B end function UniversalInfoFrame.UpdateSettings(u,i,x)u.updateInterval=i or u.updateInterval if x then end end function UniversalInfoFrame.OnReceiveDrag(i)local x,u,r=GetCursorInfo()if x=="\105\116\101\109"then local x,r,l=GetItemInfo(u)if x then i:AddText(x,"\071\101\116\073\116\101\109\067\111\117\110\116\040"..(u.."\041"),true,false,u)end ClearCursor()end end function UniversalInfoFrame.AddText(S,i,x,u,r,T)local e if type(x)=="\115\116\114\105\110\103"then e=x local i,u=loadstring("\114\101\116\117\114\110 \102\117\110\099\116\105\111\110\040\041 \114\101\116\117\114\110 "..(x.." \101\110\100"))if not i then print("\208\158\209\136\208\184\208\177\208\186\208\176 \208\183\208\176\208\179\209\128\209\131\208\183\208\186\208\184 \209\132\209\131\208\189\208\186\209\134\208\184\208\184\058",u)x=function()return"\078\047\065"end else x=i()end end if type(x)=="\110\117\109\098\101\114"then local i=x x=function()return i end end x=x or function()return"\078\047\065"end local N=i.."\058"local B,c,b=1,1,1 if T then local i,x,u=GetItemInfo(T)if u then B,c,b=GetItemQualityColor(u)end end local o=S.frame:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108\083\109\097\108\108")o:SetJustifyH("\076\069\070\084")o:SetText(N)o:SetTextColor(B,c,b)local z=S.frame:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108\083\109\097\108\108")z:SetJustifyH("\076\069\070\084")z:SetText(tostring(x()))z:SetTextColor(.59,.98,.59)local s=l("\070\114\097\109\101",nil,S.frame)s:SetAllPoints(o)s:EnableMouse(true)s:SetScript("\079\110\077\111\117\115\101\068\111\119\110",function(i,x)if x=="\076\101\102\116\066\117\116\116\111\110"then S:ToggleCollapse(o,z)elseif x=="\082\105\103\104\116\066\117\116\116\111\110"and not S.isCollapsed then S:RemoveText(o,z)end end)local C=u and S.textsTop or S.textsBottom table.insert(C,{description=i,valueFunc=x;headerText=o,valueText=z,clickFrame=s})if not r then if e then table.insert(S.saveTable,{description=i;valueFunc=e;addToTop=u})else table.insert(S.saveTable,{description=i;valueFunc=x,addToTop=u})end end S:UpdateTextPositions()S:UpdateFrameSize()end function UniversalInfoFrame.RemoveText(u,i,x)if not i or not x then return end local r=i:GetText()if not r then return end local function l(i)for x=#i,1,-1 do local l=i[x]if l.headerText and l.headerText:GetText()==r then if l.clickFrame then l.clickFrame:Hide()l.clickFrame:SetScript("\079\110\077\111\117\115\101\068\111\119\110",nil)end if l.headerText then l.headerText:Hide()l.headerText:SetText("")end if l.valueText then l.valueText:Hide()l.valueText:SetText("")end for i=#u.saveTable,1,-1 do if u.saveTable[i].description==l.description then table.remove(u.saveTable,i)break end end table.remove(i,x)break end end end l(u.textsTop)l(u.textsBottom)if u.isCollapsed then u.isCollapsed=false u.collapsedText=nil u:UpdateTextVisibility(true)end u:UpdateTextPositions()u:UpdateFrameSize()end function UniversalInfoFrame.UpdateTextPositions(i)for i,x in e(i.textsTop)do x.headerText:ClearAllPoints()x.valueText:ClearAllPoints()end for i,x in e(i.textsBottom)do x.headerText:ClearAllPoints()x.valueText:ClearAllPoints()end local x=0 for i,u in e(i.textsTop)do local r=u.headerText:GetStringWidth()if r>x then x=r end end for i,u in e(i.textsBottom)do local r=u.headerText:GetStringWidth()if r>x then x=r end end for x,u in e(i.textsTop)do if x==1 then u.headerText:SetPoint("\084\079\080\076\069\070\084",10,-10)else u.headerText:SetPoint("\084\079\080\076\069\070\084",i.textsTop[x-1].headerText,"\066\079\084\084\079\077\076\069\070\084",0,-5)end u.valueText:SetPoint("\076\069\070\084",u.headerText,"\082\073\071\072\084",5,0)end for x,u in e(i.textsBottom)do if x==1 then u.headerText:SetPoint("\066\079\084\084\079\077\076\069\070\084",10,10)else u.headerText:SetPoint("\066\079\084\084\079\077\076\069\070\084",i.textsBottom[x-1].headerText,"\084\079\080\076\069\070\084",0,5)end u.valueText:SetPoint("\076\069\070\084",u.headerText,"\082\073\071\072\084",5,0)end end local function E(i)local x=string.format("\037\046\050\102",i)if x:match("\037\046\048\048\036")then x=x:gsub("\037\046\048\048\036","")end return x end function UniversalInfoFrame.UpdateTexts(i)for i,x in e(i.textsTop)do local u=x.valueFunc()if type(u)=="\110\117\109\098\101\114"then u=E(u)end x.valueText:SetText(tostring(u))end for i,x in e(i.textsBottom)do local u=x.valueFunc()if type(u)=="\110\117\109\098\101\114"then u=E(u)end x.valueText:SetText(tostring(u))end i:UpdateFrameSize()end function UniversalInfoFrame.UpdateFrameSize(i)if i.isCollapsed and i.collapsedText then local x=i.collapsedText.headerText local u=i.collapsedText.valueText if x and u then local r=x:GetStringWidth()local l=u:GetStringWidth()local T=(r+l)+15 i.frame:SetHeight(30)i.frame:SetWidth(T+20)x:ClearAllPoints()x:SetPoint("\076\069\070\084",i.frame,"\076\069\070\084",10,0)u:ClearAllPoints()u:SetPoint("\076\069\070\084",x,"\082\073\071\072\084",5,0)end else local x=0 local u=0 for i,r in e(i.textsTop)do local l=r.headerText local T=r.valueText x=x+20 local S=l:GetStringWidth()local e=T:GetStringWidth()local N=(S+e)+15 if N>u then u=N end end for i,r in e(i.textsBottom)do local l=r.headerText local T=r.valueText x=x+20 local S=l:GetStringWidth()local e=T:GetStringWidth()local N=(S+e)+15 if N>u then u=N end end i.frame:SetHeight(x+20)i.frame:SetWidth(u+20)end end function UniversalInfoFrame.ToggleCollapse(u,i,x)if u.isCollapsed then u.isCollapsed=false u.collapsedText=nil for i,x in e(u.textsTop)do x.headerText:Show()x.valueText:Show()end for i,x in e(u.textsBottom)do x.headerText:Show()x.valueText:Show()end else u.isCollapsed=true for x,r in e(u.textsTop)do if r.headerText==i then u.collapsedText=r break end end for x,r in e(u.textsBottom)do if r.headerText==i then u.collapsedText=r break end end for x,u in e(u.textsTop)do if u.headerText~=i then u.headerText:Hide()u.valueText:Hide()end end for x,u in e(u.textsBottom)do if u.headerText~=i then u.headerText:Hide()u.valueText:Hide()end end end u:UpdateTextPositions()u:UpdateFrameSize()end function UniversalInfoFrame.OnUpdate(x,i)x.timeElapsed=x.timeElapsed+i if x.timeElapsed>x.updateInterval then x.timeElapsed=0 x:UpdateTexts()end end function UniversalInfoFrame.Show(i)i.frame:Show()end function UniversalInfoFrame.Hide(i)i.frame:Hide()end ChatHandler={}ChatHandler.__index=ChatHandler local q={}OBJECT_POSITION_PATTERNS={}for i=1,100,1 do OBJECT_POSITION_PATTERNS[i]="\094"..(string.rep("\046\046\046",i-1).."\040\046\046\046\041")end WORD_POSITION_PATTERNS={}for i=1,10,1 do WORD_POSITION_PATTERNS[i]="\094"..(string.rep("\037\083\042\037\115\043",i-1).."\040\037\083\043\041")end local function R(i,x)q[i]=x end local function F(i)return q[i]end function ChatHandler.new(r,i,x)local T=u({},r)T.triggersByAddress=i or{}T.frame=l("\070\114\097\109\101")local S=x and{}or{"\067\072\065\084\095\077\083\071\095\067\072\065\078\078\069\076";"\067\072\065\084\095\077\083\071\095\083\065\089","\067\072\065\084\095\077\083\071\095\089\069\076\076","\067\072\065\084\095\077\083\071\095\087\072\073\083\080\069\082","\067\072\065\084\095\077\083\071\095\071\085\073\076\068";"\067\072\065\084\095\077\083\071\095\080\065\082\084\089","\067\072\065\084\095\077\083\071\095\082\065\073\068";"\067\072\065\084\095\077\083\071\095\082\065\073\068\095\087\065\082\078\073\078\071";"\067\072\065\084\095\077\083\071\095\066\065\084\084\076\069\071\082\079\085\078\068";"\067\072\065\084\095\077\083\071\095\083\089\083\084\069\077";"\067\072\065\084\095\077\083\071\095\065\068\068\079\078"}if x then for i,x in e(x)do T.frame:RegisterEvent(x=="\065\068\068\079\078"and"\067\072\065\084\095\077\083\071\095\065\068\068\079\078"or"\067\072\065\084\095\077\083\071\095"..x)end else for i,x in e(S)do T.frame:RegisterEvent(x)end end T.frame:SetScript("\079\110\069\118\101\110\116",function(i,x,...)T:OnChatMessage(x,...)end)return T end function ChatHandler.OnChatMessage(x,i,...)local u,r,l,T if i=="\067\072\065\084\095\077\083\071\095\065\068\068\079\078"then l,u,_,r=...else u,r=...end if x.triggersByAddress["\042"]then for S,e in e(x.triggersByAddress["\042"])do if x:CheckTrigger(e,u,r,T,l,i)and e.stopOnMatch then return end end end local S=i=="\067\072\065\084\095\077\083\071\095\065\068\068\079\078"and"\112\114\101\102\105\120\058"..(l:match("\094\040\037\083\043\041")or"")local N="\109\101\115\115\097\103\101\058"..(u:match("\094\040\037\083\043\041")or"")for S,N in e({S;N})do if N and x.triggersByAddress[N]then for S,e in e(x.triggersByAddress[N])do if x:CheckTrigger(e,u,r,T,l,i)then return end end end end end function ChatHandler.CheckTrigger(S,i,x,u,r,l,T)if i.chatType then local x=T:match("\067\072\065\084\095\077\083\071\095\040\046\043\041\036")local u=false for i,r in e(i.chatType)do if r==x then u=true break end end if not u then return false end end local N=x:lower()for i,x in e(i.forbiddenWords or{})do local u=type(x)=="\115\116\114\105\110\103"and(x:sub(1,1)=="\036"and F(x:sub(2)))or x if type(u)=="\116\097\098\108\101"then for i,x in e(u)do if N:find(x:lower(),1,true)then return false end end elseif u and N:find(u:lower(),1,true)then return false end end for i,u in e(i.keyword)do local r=u.source=="\112\114\101\102\105\120"and l or x if not r then return false end local T=WORD_POSITION_PATTERNS[u.position]local S=r:match(T)if not S or S~=u.word then return false end end for i,T in e(i.conditions or{})do local S=type(T)=="\115\116\114\105\110\103"and _G[T]or T if not S or not S(x,u,r,l)then return false end end local B=_G[i.func]if B then B(T,x,u,l,r)return i.stopOnMatch else print("\208\158\209\136\208\184\208\177\208\186\208\176\058 \209\132\209\131\208\189\208\186\209\134\208\184\209\143 \'"..(i.func.."\' \208\189\208\181 \208\189\208\176\208\185\208\180\208\181\208\189\208\176"))end return false end CustomAchievements={}CustomAchievements.__index=CustomAchievements local t=40 local K=48 local V=50 local Y=100 local L=16 local f="\065\078\067\072\079\082\095\082\073\071\072\084"local P=10 CustomAchievements.COLLAPSED_POSITIONS={icon={x=5;y=0},name={x=50,y=-5},date={x=300,y=-5};rewardPoints={x=440;y=-5}}CustomAchievements.EXPANDED_POSITIONS={icon={x=5,y=0};name={x=50;y=-5};description={x=50;y=-25},date={x=300;y=-5};rewardPoints={x=440,y=-5},requiredAchievements={x=50;y=-50}}local j="\073\110\116\101\114\102\097\099\101\092\070\114\097\109\101\071\101\110\101\114\097\108\092\085\073-\066\097\099\107\103\114\111\117\110\100-\082\111\099\107"local J="\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\085\073-\076\105\115\116\098\111\120-\072\105\103\104\108\105\103\104\116"local k="\073\110\116\101\114\102\097\099\101\092\065\099\104\105\101\118\101\109\101\110\116\070\114\097\109\101\092\085\073-\065\099\104\105\101\118\101\109\101\110\116-\080\097\114\099\104\109\101\110\116-\072\111\114\105\122\111\110\116\097\108-\068\101\115\097\116\117\114\097\116\101\100"local X="\073\110\116\101\114\102\097\099\101\092\065\099\104\105\101\118\101\109\101\110\116\070\114\097\109\101\092\085\073-\065\099\104\105\101\118\101\109\101\110\116-\065\099\104\105\101\118\101\109\101\110\116\066\097\099\107\103\114\111\117\110\100"local g="\073\110\116\101\114\102\097\099\101\092\065\099\104\105\101\118\101\109\101\110\116\070\114\097\109\101\092\085\073-\065\099\104\105\101\118\101\109\101\110\116-\083\104\105\101\108\100\115"local function y(i,x,u)local r=i:CreateFontString(nil,"\079\086\069\082\076\065\089",x)r:SetJustifyH(u or"\076\069\070\084")return r end local function A(i,x,u)local r=i:CreateTexture(nil,x)r:SetTexture(u)return r end function CustomAchievements.new(r,i,x)local l=u({},r)l.staticData=_G[i]l.dynamicData=_G[x]or{}l.frame=nil l.buttons={}l.tabCreated=false l.nightWatchTab=nil l.selectedButton=nil l.customAlertFrame=nil if not l.staticData or type(l.staticData)~="\116\097\098\108\101"then error("\208\158\209\136\208\184\208\177\208\186\208\176\058 \209\129\209\130\208\176\209\130\208\184\209\135\208\181\209\129\208\186\208\176\209\143 \209\130\208\176\208\177\208\187\208\184\209\134\208\176 \208\180\208\176\208\189\208\189\209\139\209\133 \208\189\208\181 \208\189\208\176\208\185\208\180\208\181\208\189\208\176 \208\184\208\187\208\184 \208\189\208\181\208\186\208\190\209\128\209\128\208\181\208\186\209\130\208\189\208\176\046")end if not l.dynamicData or type(l.dynamicData)~="\116\097\098\108\101"then error("\208\158\209\136\208\184\208\177\208\186\208\176\058 \208\180\208\184\208\189\208\176\208\188\208\184\209\135\208\181\209\129\208\186\208\176\209\143 \209\130\208\176\208\177\208\187\208\184\209\134\208\176 \208\180\208\176\208\189\208\189\209\139\209\133 \208\189\208\181 \208\189\208\176\208\185\208\180\208\181\208\189\208\176 \208\184\208\187\208\184 \208\189\208\181\208\186\208\190\209\128\209\128\208\181\208\186\209\130\208\189\208\176\046")end return l end function CustomAchievements.GetAchievementData(u,x)for i,r in i(u.staticData)do local l=r[x]if l then local r=u.dynamicData[x]return{name=l.name;description=l.description;texture=l.texture;rewardPoints=l.rewardPoints;requiredAchievements=l.requiredAchievements,subAchievements=l.subAchievements or{},dateEarned=r and r.dateEarned or"\208\157\208\181 \208\191\208\190\208\187\209\131\209\135\208\181\208\189\208\176",dateCompleted=r and r.dateCompleted or"\208\157\208\181 \208\178\209\139\208\191\208\190\208\187\208\189\208\181\208\189\208\176",progress=r and r.progress or 0,isExpanded=r and r.isExpanded or false;scrollPosition=r and r.scrollPosition or 0;category=i}end end return nil end function CustomAchievements.CreateNightWatchTab(i)if not AchievementFrameTab1 then return end local x=AchievementFrameTab1 local u=1 while _G["\065\099\104\105\101\118\101\109\101\110\116\070\114\097\109\101\084\097\098"..u+1]do x=_G["\065\099\104\105\101\118\101\109\101\110\116\070\114\097\109\101\084\097\098"..u+1]u=u+1 end i.nightWatchTab=l("\066\117\116\116\111\110","\065\099\104\105\101\118\101\109\101\110\116\070\114\097\109\101\084\097\098"..u+1,AchievementFrame,"\065\099\104\105\101\118\101\109\101\110\116\070\114\097\109\101\084\097\098\066\117\116\116\111\110\084\101\109\112\108\097\116\101")i.nightWatchTab:SetText("\208\157\208\190\209\135\208\189\208\176\209\143 \209\129\209\130\209\128\208\176\208\182\208\176")i.nightWatchTab:SetPoint("\076\069\070\084",x,"\082\073\071\072\084",-6,0)local r=i.nightWatchTab:GetFontString()if r then r:SetText("\208\157\208\190\209\135\208\189\208\176\209\143 \209\129\209\130\209\128\208\176\208\182\208\176")else return end PanelTemplates_TabResize(i.nightWatchTab,0)i.nightWatchTab:SetScript("\079\110\067\108\105\099\107",function()AchievementFrameSummary:Hide()AchievementFrameAchievements:Hide()AchievementFrameStats:Hide()for i=1,20,1 do local x=_G["\065\099\104\105\101\118\101\109\101\110\116\070\114\097\109\101\067\097\116\101\103\111\114\105\101\115\067\111\110\116\097\105\110\101\114\066\117\116\116\111\110"..i]if x then x:Hide()end end i:Show()i:UpdateUI(i.selectedCategory)PanelTemplates_SetTab(AchievementFrame,u+1)end)end local function v(i,x,u,r,l,T,S,e)local N=i:CreateFontString(nil,"\079\086\069\082\076\065\089",x)N:SetJustifyH(u)N:SetPoint(r,l,T,S,e)return N end local function Z(i,x,u,r,l,T,S,e,N,B)local c=i:CreateTexture(nil,x)c:SetTexture(u)c:SetSize(r,l)c:SetPoint(T,S,e,N,B)return c end function CustomAchievements.SyncDynamicData(x)if not x:IsStructureChanged()then return end local u={}for r,l in i(x.staticData)do for i,r in i(l)do local l=r.uniqueIndex if l and x.dynamicData[i]then u[l]=x.dynamicData[i]end end end for r,l in i(x.staticData)do for i,r in i(l)do local l=r.uniqueIndex if l then if u[l]then x.dynamicData[i]=u[l]else x.dynamicData[i]={uniqueIndex=l;dateEarned="\208\157\208\181 \208\191\208\190\208\187\209\131\209\135\208\181\208\189\208\176";dateCompleted="\208\157\208\181 \208\178\209\139\208\191\208\190\208\187\208\189\208\181\208\189\208\176",progress=0,isExpanded=false;scrollPosition=0}end end end end local r={}for u,l in i(x.dynamicData)do local T=false for i,x in i(x.staticData)do if x[u]then T=true break end end if not T then table.insert(r,u)end end for i,u in e(r)do x.dynamicData[u]=nil end end function CustomAchievements.IsStructureChanged(x)local u={}local r={}for x,r in i(x.staticData)do for i,x in i(r)do if x.uniqueIndex then u[x.uniqueIndex]=i end end end for i,x in i(x.dynamicData)do if x.uniqueIndex then r[x.uniqueIndex]=i end end for i,x in i(u)do local u=r[i]if u~=x then return true end end for i in i(r)do if not u[i]then return true end end return false end function CustomAchievements.FindAchievementIdByUniqueIndex(u,x)for u,r in i(u.staticData)do for i,u in i(r)do if u.uniqueIndex==x then return i end end end return nil end function CustomAchievements.FindAchievementIdByName(u,x)for i,u in i(u.staticData)do if u[x]then return x end end return nil end function CustomAchievements.CreateFrame(x,i)x.frame=l("\070\114\097\109\101",nil,i)x.frame:SetSize(850,500)x.frame:SetPoint("\067\069\078\084\069\082")x.frame:Hide()local u=x.frame:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\072\105\103\104\108\105\103\104\116")u:SetPoint("\084\079\080",130,-10)x:CreateCategoryButtons(x.frame)x.achievementList=l("\083\099\114\111\108\108\070\114\097\109\101","\097\099\104\105\101\118\101\109\101\110\116\083\099\114\111\108\108\070\114\097\109\101",x.frame,"\085\073\080\097\110\101\108\083\099\114\111\108\108\070\114\097\109\101\084\101\109\112\108\097\116\101")x.achievementList:SetSize(690,450)x.achievementList:SetPoint("\084\079\080\076\069\070\084",x.categoryContainer,"\084\079\080\082\073\071\072\084",-100,0)x.achievementContainer=l("\070\114\097\109\101",nil,x.achievementList)x.achievementContainer:SetSize(720,450)x.achievementList:SetScrollChild(x.achievementContainer)local r=A(x.achievementContainer,"\066\065\067\075\071\082\079\085\078\068",j)r:SetAllPoints()r:SetVertexColor(1,1,1,1)local T=l("\083\108\105\100\101\114",nil,x.achievementList,"\085\073\080\097\110\101\108\083\099\114\111\108\108\066\097\114\084\101\109\112\108\097\116\101")T:Hide()T:SetPoint("\084\079\080\076\069\070\084",x.achievementList,"\084\079\080\082\073\071\072\084",-20,-16)T:SetPoint("\066\079\084\084\079\077\076\069\070\084",x.achievementList,"\066\079\084\084\079\077\082\073\071\072\084",-20,16)T:SetWidth(L)T:SetValueStep(1)T:SetFrameStrata("\068\073\065\076\079\071")T:SetScript("\079\110\086\097\108\117\101\067\104\097\110\103\101\100",function(i,x)(i:GetParent()):SetVerticalScroll(x)end)x.achievementList.scrollBar=T x.achievementList:SetScript("\079\110\077\111\117\115\101\087\104\101\101\108",function(i,x)T:SetValue(T:GetValue()-x*20)end)end function CustomAchievements.CreateCategoryButtons(u,x)if not x then error("\080\097\114\101\110\116 \102\114\097\109\101 \105\115 \114\101\113\117\105\114\101\100 \102\111\114 \099\114\101\097\116\105\110\103 \099\097\116\101\103\111\114\121 \098\117\116\116\111\110\115\046")end local r={}for i,x in i(u.staticData)do r[#r+1]=i end local T=100 local S=20 local N=0 u.categoryButtons={}u.categoryContainer=l("\070\114\097\109\101",nil,x)u.categoryContainer:SetSize(T,#r*S+10)u.categoryContainer:SetPoint("\084\079\080\076\069\070\084",x,"\084\079\080\076\069\070\084",70,-30)for i,x in e(r)do local r=l("\066\117\116\116\111\110",nil,u.categoryContainer)r:SetSize(T+80,S)r:SetPoint("\084\079\080\076\069\070\084",u.categoryContainer,"\084\079\080\076\069\070\084",0,-N)local e=r:CreateTexture(nil,"\066\065\067\075\071\082\079\085\078\068")e:SetTexture("\073\110\116\101\114\102\097\099\101\092\065\099\104\105\101\118\101\109\101\110\116\070\114\097\109\101\092\085\073-\065\099\104\105\101\118\101\109\101\110\116-\067\097\116\101\103\111\114\121-\066\097\099\107\103\114\111\117\110\100")e:SetPoint("\067\069\078\084\069\082",r,"\067\069\078\084\069\082")e:SetSize(200,35)e:SetTexCoord(0,.6640625,0,1)local B=r:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\072\105\103\104\108\105\103\104\116")B:SetPoint("\067\069\078\084\069\082",r,"\067\069\078\084\069\082",0,3)B:SetText(x)local c=r:CreateTexture(nil,"\072\073\071\072\076\073\071\072\084")c:SetAllPoints()c:SetTexture("\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\085\073-\076\105\115\116\098\111\120-\072\105\103\104\108\105\103\104\116")c:SetBlendMode("\065\068\068")c:SetTexCoord(0,1,0,.5)r:SetScript("\079\110\067\108\105\099\107",function()u:FilterAchievementsByCategory(x)end)u.categoryButtons[x]=r N=(N+S)+5 end end function CustomAchievements.FilterAchievementsByCategory(x,i)if not x.achievementContainer then return end x.selectedCategory=i x:UpdateUI(i)end function CustomAchievements.AddAchievement(x,i)if not x.staticData[i]then print("\208\158\209\136\208\184\208\177\208\186\208\176\058 \208\176\209\135\208\184\208\178\208\186\208\176 \209\129 \073\068 "..(i.." \208\189\208\181 \208\189\208\176\208\185\208\180\208\181\208\189\208\176 \208\178 \209\129\209\130\208\176\209\130\208\184\209\135\208\189\209\139\209\133 \208\180\208\176\208\189\208\189\209\139\209\133"))return end if x.dynamicData[i]then return end local u=date("\037\100\047\037\109\047\037\089 \037\072\058\037\077")x.dynamicData[i]={uniqueIndex=x.staticData[i].uniqueIndex,dateEarned=u,dateCompleted="\208\157\208\181 \208\178\209\139\208\191\208\190\208\187\208\189\208\181\208\189\208\176";progress=0,isExpanded=false;scrollPosition=0}x:UpdateUI(x.selectedCategory)x:ShowAchievementAlert(i)end function CustomAchievements.UpdateUI(u,x)u:SyncDynamicData()if not u.achievementContainer then return end for i,x in e({u.achievementContainer:GetChildren()})do x:Hide()x:ClearAllPoints()x:SetParent(nil)end u.buttons={}local r=0 local l={}for u,r in i(u.staticData)do if not x or u==x then for i,x in i(r)do table.insert(l,{name=i,index=x.index or 0})end end end table.sort(l,function(i,x)return i.index<x.index end)for i,x in e(l)do local l=x.name local T=u.dynamicData[l]or{}local S=u.buttons[l]or u:CreateAchievementButton(l,r)if S then u.buttons[l]=S r=r+S:GetHeight()end end u:UpdateScrollArea(r)end function CustomAchievements.UpdateScrollArea(x,i)local u=x.achievementList.scrollBar local r=i+60 x.achievementContainer:SetHeight(r)if u then local i=r-x.achievementList:GetHeight()u:SetMinMaxValues(0,math.max(0,i))u:SetValue(0)end end function CustomAchievements.SendAchievementCompletionMessage(x,i)local u=x:GetAchievementFullData(i)if u then SendChatMessage("\208\148\208\190\209\129\209\130\208\184\208\182\208\181\208\189\208\184\208\181 "..(u.name..("\058 "..u.dateCompleted)),"\079\070\070\073\067\069\082",nil,1)end end function CustomAchievements.CreateAchievementButton(u,i,x)local r=u:GetAchievementFullData(i)if not r then return nil end local T=l("\066\117\116\116\111\110",nil,u.achievementContainer)T:SetSize(510,V)T:SetPoint("\084\079\080\076\069\070\084",u.achievementContainer,"\084\079\080\076\069\070\084",195,-x)T.id=i T.icon=Z(T,"\065\082\084\087\079\082\075",r.texture,t,t,"\084\079\080\076\069\070\084",T,"\084\079\080\076\069\070\084",u.COLLAPSED_POSITIONS.icon.x,u.COLLAPSED_POSITIONS.icon.y)T.nameText=v(T,"\071\097\109\101\070\111\110\116\072\105\103\104\108\105\103\104\116","\076\069\070\084","\084\079\080\076\069\070\084",T.icon,"\084\079\080\082\073\071\072\084",5,0)T.nameText:SetText(r.name)T.dateText=v(T,"\071\097\109\101\070\111\110\116\078\111\114\109\097\108","\076\069\070\084","\084\079\080\076\069\070\084",T,"\084\079\080\076\069\070\084",u.COLLAPSED_POSITIONS.date.x,u.COLLAPSED_POSITIONS.date.y)T.dateText:SetText(r.dateEarned)T.rewardPointsIcon=Z(T,"\065\082\084\087\079\082\075",g,K,K,"\084\079\080\076\069\070\084",T,"\084\079\080\076\069\070\084",u.COLLAPSED_POSITIONS.rewardPoints.x,u.COLLAPSED_POSITIONS.rewardPoints.y)if r.dateCompleted~="\208\157\208\181 \208\178\209\139\208\191\208\190\208\187\208\189\208\181\208\189\208\176"then T.rewardPointsIcon:SetTexCoord(0,.5,0,1)else T.rewardPointsIcon:SetTexCoord(.5,1,0,1)end T.rewardPointsText=v(T,"\071\097\109\101\070\111\110\116\078\111\114\109\097\108","\067\069\078\084\069\082","\067\069\078\084\069\082",T.rewardPointsIcon,"\067\069\078\084\069\082",0,0)T.rewardPointsText:SetText(r.rewardPoints)T.highlight=Z(T,"\066\065\067\075\071\082\079\085\078\068",J,510,V,"\084\079\080\076\069\070\084",T,"\084\079\080\076\069\070\084",0,0)T.highlight:SetAlpha(0)T.normal=Z(T,"\066\065\067\075\071\082\079\085\078\068",r.dateCompleted~="\208\157\208\181 \208\178\209\139\208\191\208\190\208\187\208\189\208\181\208\189\208\176"and X or k,510,V,"\084\079\080\076\069\070\084",T,"\084\079\080\076\069\070\084",0,0)T.normal:SetAlpha(1)T:RegisterForClicks("\082\105\103\104\116\066\117\116\116\111\110\068\111\119\110","\076\101\102\116\066\117\116\116\111\110\068\111\119\110")T:SetScript("\079\110\067\108\105\099\107",function(x,r)if r=="\076\101\102\116\066\117\116\116\111\110"then u.dynamicData[i].isExpanded=not u.dynamicData[i].isExpanded local x=u.achievementList.scrollBar:GetValue()u:UpdateUI(u.selectedCategory)u.achievementList.scrollBar:SetValue(x)elseif r=="\082\105\103\104\116\066\117\116\116\111\110"then u:SendAchievementCompletionMessage(i)end end)T:SetScript("\079\110\069\110\116\101\114",function()T.highlight:SetAlpha(1)u:ShowAchievementTooltip(T,i)end)T:SetScript("\079\110\076\101\097\118\101",function()T.highlight:SetAlpha(0)GameTooltip:Hide()end)if r.isExpanded then u:ExpandAchievement(T,i)end return T end function CustomAchievements.ShowAchievementTooltip(u,i,x)local r=u:GetAchievementFullData(x)if not r then return end GameTooltip:SetOwner(i,f)GameTooltip:SetText(r.name)GameTooltip:AddLine(r.description,1,1,1,true)GameTooltip:AddLine("\208\148\208\176\209\130\208\176 \208\191\208\190\208\187\209\131\209\135\208\181\208\189\208\184\209\143\058 "..r.dateEarned)if r.dateCompleted~="\208\157\208\181 \208\178\209\139\208\191\208\190\208\187\208\189\208\181\208\189\208\176"then GameTooltip:AddLine("\208\146\209\139\208\191\208\190\208\187\208\189\208\181\208\189\208\190\058 "..r.dateCompleted)end GameTooltip:Show()end function CustomAchievements.ExpandAchievement(u,i,x)local r=u:GetAchievementFullData(x)if not r then return end if not i.descriptionText then i.descriptionText=i:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108")i.descriptionText:SetWidth(400)i.descriptionText:SetWordWrap(true)i.descriptionText:SetText(r.description)i.descriptionText:SetJustifyH("\076\069\070\084")i.descriptionText:Hide()end i.icon:SetPoint("\084\079\080\076\069\070\084",i,"\084\079\080\076\069\070\084",u.EXPANDED_POSITIONS.icon.x,u.EXPANDED_POSITIONS.icon.y)i.nameText:SetPoint("\084\079\080\076\069\070\084",i,"\084\079\080\076\069\070\084",u.EXPANDED_POSITIONS.name.x,u.EXPANDED_POSITIONS.name.y)i.dateText:SetPoint("\084\079\080\076\069\070\084",i,"\084\079\080\076\069\070\084",u.EXPANDED_POSITIONS.date.x,u.EXPANDED_POSITIONS.date.y)i.rewardPointsIcon:SetPoint("\084\079\080\076\069\070\084",i,"\084\079\080\076\069\070\084",u.EXPANDED_POSITIONS.rewardPoints.x,u.EXPANDED_POSITIONS.rewardPoints.y)i.descriptionText:SetPoint("\084\079\080\076\069\070\084",i,"\084\079\080\076\069\070\084",u.EXPANDED_POSITIONS.description.x,u.EXPANDED_POSITIONS.description.y)i.descriptionText:Show()local l=i.descriptionText:GetHeight()local T=-80 local S=30 local N=5 for x,r in e(r.subAchievements)do local l=u:GetAchievementFullData(r)if l then u:CreateNestedAchievementIcon(i,l,x,u.EXPANDED_POSITIONS.requiredAchievements.x,T,S,N)end end local B=math.ceil(#r.subAchievements/P)local c=(Y+l)+B*(S+N)i:SetHeight(c-30)i.normal:SetAllPoints()i.highlight:SetAllPoints()end function CustomAchievements.CreateNestedAchievementIcon(N,i,x,u,r,T,S,e)local B=l("\066\117\116\116\111\110",nil,i)B:SetSize(S,S)local c=(u-1)%P local b=math.floor((u-1)/P)B:SetPoint("\084\079\080\076\069\070\084",i,"\084\079\080\076\069\070\084",r+c*(S+e),T-b*(S+e))local o=A(B,"\065\082\084\087\079\082\075",x.texture)o:SetAllPoints()if x.dateCompleted~="\208\157\208\181 \208\178\209\139\208\191\208\190\208\187\208\189\208\181\208\189\208\176"then o:SetDesaturated(false)else o:SetDesaturated(true)end B:SetScript("\079\110\077\111\117\115\101\068\111\119\110",function()N:NavigateToAchievement(x.id)end)B:SetScript("\079\110\069\110\116\101\114",function()GameTooltip:SetOwner(B,"\065\078\067\072\079\082\095\082\073\071\072\084")GameTooltip:SetText(x.name)GameTooltip:AddLine(x.description,1,1,1,true)GameTooltip:AddLine("\208\148\208\176\209\130\208\176 \208\191\208\190\208\187\209\131\209\135\208\181\208\189\208\184\209\143\058 "..x.dateEarned)if x.dateCompleted~="\208\157\208\181 \208\178\209\139\208\191\208\190\208\187\208\189\208\181\208\189\208\176"then GameTooltip:AddLine("\208\146\209\139\208\191\208\190\208\187\208\189\208\181\208\189\208\190\058 "..x.dateCompleted)end GameTooltip:Show()end)B:SetScript("\079\110\076\101\097\118\101",function()GameTooltip:Hide()end)end function CustomAchievements.NavigateToAchievement(u,x)for i,x in i(u.dynamicData)do x.isExpanded=false end local r=u.dynamicData[x]if r then r.isExpanded=true end u:UpdateUI()local l=u.achievementList.scrollBar local T=r and r.scrollPosition or 0 l:SetValue(T)end function CustomAchievements.HideAchievements(x)if x.frame then x.frame:Hide()end for i,x in i(x.buttons)do x:Hide()end end function CustomAchievements.ShowAchievements(x)for i,x in i(x.buttons)do x:Show()end end function CustomAchievements.Show(i)if i.frame then i.frame:Show()i:UpdateUI(i.selectedCategory)i:ShowAchievements()end end function CustomAchievements.Hide(i)if i.frame then i.frame:Hide()i.selectedCategory=nil i:UpdateUI()end end function CustomAchievements.CreateCustomAlertFrame(i)local x=l("\070\114\097\109\101","\067\117\115\116\111\109\065\099\104\105\101\118\101\109\101\110\116\065\108\101\114\116\070\114\097\109\101",UIParent)x:SetFrameStrata("\068\073\065\076\079\071")x:SetFrameLevel(100)x:SetPoint("\067\069\078\084\069\082",UIParent,"\067\069\078\084\069\082",0,200)x:SetBackdrop({bgFile="\073\110\116\101\114\102\097\099\101\092\068\105\097\108\111\103\070\114\097\109\101\092\085\073-\068\105\097\108\111\103\066\111\120-\066\097\099\107\103\114\111\117\110\100",edgeFile="\073\110\116\101\114\102\097\099\101\092\068\105\097\108\111\103\070\114\097\109\101\092\085\073-\068\105\097\108\111\103\066\111\120-\066\111\114\100\101\114",tile=true,tileSize=32,edgeSize=32,insets={left=11,right=12,top=12;bottom=11}})x:SetBackdropColor(0,0,0,.8)x:SetAlpha(1)x.Icon=x:CreateTexture(nil,"\065\082\084\087\079\082\075")x.Icon:SetSize(40,40)x.Icon:SetPoint("\084\079\080\076\069\070\084",x,"\084\079\080\076\069\070\084",10,-10)x.Icon:SetTexture("\073\110\116\101\114\102\097\099\101\092\073\099\111\110\115\092\065\098\105\108\105\116\121\095\082\111\103\117\101\095\083\104\097\100\111\119\083\116\114\105\107\101\115")x.Name=x:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\072\105\103\104\108\105\103\104\116")x.Name:SetPoint("\084\079\080\076\069\070\084",x.Icon,"\084\079\080\082\073\071\072\084",10,0)x.Name:SetJustifyH("\076\069\070\084")x.Name:SetText("\208\157\208\176\208\183\208\178\208\176\208\189\208\184\208\181 \208\176\209\135\208\184\208\178\208\186\208\184")x.Description=x:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108")x.Description:SetPoint("\084\079\080\076\069\070\084",x.Name,"\066\079\084\084\079\077\076\069\070\084",0,-5)x.Description:SetJustifyH("\076\069\070\084")x.Description:SetText("\208\158\208\191\208\184\209\129\208\176\208\189\208\184\208\181 \208\176\209\135\208\184\208\178\208\186\208\184")x.UpdateSize=function(i)local x=i.Name:GetStringWidth()local u=i.Description:GetStringWidth()local r=math.max(x,u)local l=300 local T=math.max(l,r+75)local S=(i.Name:GetHeight()+i.Description:GetHeight())+35 i:SetSize(T,S)i.Name:SetPoint("\084\079\080\076\069\070\084",i.Icon,"\084\079\080\082\073\071\072\084",10,0)i.Description:SetPoint("\084\079\080\076\069\070\084",i.Name,"\066\079\084\084\079\077\076\069\070\084",0,-5)end return x end function CustomAchievements.GetAchievementData(u,x)for i,r in i(u.staticData)do if r[x]then return u.dynamicData[x]end end return nil end function CustomAchievements.GetAchievementFullData(u,x)for i,r in i(u.staticData)do if r[x]then local i=r[x]local l=u.dynamicData[x]or{}return{name=i.name,description=i.description;texture=i.texture;rewardPoints=i.rewardPoints;requiredAchievements=i.requiredAchievements,subAchievements=i.subAchievements or{};dateEarned=l.dateEarned or"\208\157\208\181 \208\191\208\190\208\187\209\131\209\135\208\181\208\189\208\176";dateCompleted=l.dateCompleted or"\208\157\208\181 \208\178\209\139\208\191\208\190\208\187\208\189\208\181\208\189\208\176",progress=l.progress or 0,isExpanded=l.isExpanded or false,scrollPosition=l.scrollPosition or 0;category=r,send_txt=i.send_txt,subAchievements_args=i.subAchievements_args;achievement_args=i.achievement_args,achFunc=i.achFunc}end end return nil end function CustomAchievements.ShowAchievementAlert(x,i)local u=x:GetAchievementFullData(i)if not u then print("\208\144\209\135\208\184\208\178\208\186\208\176 \209\129 \208\184\208\188\208\181\208\189\208\181\208\188 "..(i.." \208\189\208\181 \208\189\208\176\208\185\208\180\208\181\208\189\208\176\046"))return end if not x.customAlertFrame then x.customAlertFrame=x:CreateCustomAlertFrame()end x.customAlertFrame.Name:SetText(u.name)x.customAlertFrame.Description:SetText(u.description)x.customAlertFrame.Icon:SetTexture(u.texture)x.customAlertFrame:UpdateSize()x.customAlertFrame:SetAlpha(1)x.customAlertFrame:Show()x.customAlertFrame.timer=5 x.customAlertFrame.elapsed=0 x.customAlertFrame:SetScript("\079\110\085\112\100\097\116\101",function(i,x)i.elapsed=i.elapsed+x if i.elapsed>=i.timer then local u=i:GetAlpha()u=u-x*.5 if u<=0 then u=0 i:Hide()i:SetScript("\079\110\085\112\100\097\116\101",nil)end i:SetAlpha(u)end end)end function CustomAchievements.IsAchievement(u,x)for i,r in i(u.staticData)do if r[x]then local i=r[x].uniqueIndex return u.dynamicData[x]~=nil and u.dynamicData[x].uniqueIndex==i end end return false end function CustomAchievements.GetAchievementCount(x)local u=0 for i,x in i(x.dynamicData)do u=u+1 end return u end function CustomAchievements.setData(r,i,x,u)if not r.dynamicData[i]then print("\208\158\209\136\208\184\208\177\208\186\208\176\058 \208\176\209\135\208\184\208\178\208\186\208\176 \209\129 \208\184\208\188\208\181\208\189\208\181\208\188 "..(i.." \208\189\208\181 \208\189\208\176\208\185\208\180\208\181\208\189\208\176 \208\178 \208\180\208\184\208\189\208\176\208\188\208\184\209\135\208\181\209\129\208\186\208\190\208\185 \209\130\208\176\208\177\208\187\208\184\209\134\208\181\046"))return end local l={dateEarned=true;dateCompleted=true,progress=true;isExpanded=true;scrollPosition=true}if not l[x]then print("\208\158\209\136\208\184\208\177\208\186\208\176\058 \208\186\208\187\209\142\209\135 "..(x.." \208\189\208\181\208\180\208\190\208\191\209\131\209\129\209\130\208\184\208\188 \208\180\208\187\209\143 \208\184\208\183\208\188\208\181\208\189\208\181\208\189\208\184\209\143\046"))return end r.dynamicData[i][x]=u r:UpdateUI(r.selectedCategory)end NSQCMenu={}NSQCMenu.__index=NSQCMenu function NSQCMenu.new(r,i,x)local T=u({},r)T.addonName=i T.subMenus={}T.elements={}T.mainFrame=l("\070\114\097\109\101",i.."\077\097\105\110\070\114\097\109\101",InterfaceOptionsFramePanelContainer)T.mainFrame.name=i T.mainFrame:Hide()T.currentY=-50 local S=T.mainFrame:CreateFontString(nil,"\065\082\084\087\079\082\075","\071\097\109\101\070\111\110\116\078\111\114\109\097\108\076\097\114\103\101")S:SetPoint("\084\079\080\076\069\070\084",16,-16)S:SetText(i)InterfaceOptions_AddCategory(T.mainFrame)return T end function NSQCMenu.addInfoSection(u,i,x)local r=u.mainFrame local l=u.currentY local T=r:CreateFontString(nil,"\065\082\084\087\079\082\075","\071\097\109\101\070\111\110\116\078\111\114\109\097\108")T:SetPoint("\084\079\080\076\069\070\084",20,l-10)T:SetText(i)T:SetTextColor(1,.82,0)local S=r:CreateFontString(nil,"\065\082\084\087\079\082\075","\071\097\109\101\070\111\110\116\087\104\105\116\101")S:SetPoint("\084\079\080\076\069\070\084",30,l-30)S:SetWidth(550)S:SetJustifyH("\076\069\070\084")S:SetJustifyV("\084\079\080")S:SetText(u:wrapText(x,540,"\071\097\109\101\070\111\110\116\087\104\105\116\101"))local e=S:GetStringHeight()u.currentY=(l-40)-e table.insert(u.elements,{T;S})end function NSQCMenu.wrapText(r,i,x,u)local l=""local T=""for i in i:gmatch("\037\083\043")do local S=T..(" "..i)local e=r:getStringWidth(r.mainFrame,S,u)if e>x then l=l..(T.."\n")T=i else T=S end end return l..T end function NSQCMenu.getStringWidth(r,i,x,u)if not i then print("\069\114\114\111\114\058 \070\114\097\109\101 \105\115 \110\105\108 \105\110 \103\101\116\083\116\114\105\110\103\087\105\100\116\104")return 0 end local l=i:CreateFontString(nil,"\065\082\084\087\079\082\075",u)l:SetText(x)local T=l:GetStringWidth()l:Hide()return T end function NSQCMenu.addSubMenu(x,i)local u=l("\070\114\097\109\101",x.addonName..(i.."\083\117\098\070\114\097\109\101"),InterfaceOptionsFramePanelContainer)u.name=i u.parent=x.addonName u:Hide()local r=l("\083\099\114\111\108\108\070\114\097\109\101",i.."\083\099\114\111\108\108\070\114\097\109\101",u,"\085\073\080\097\110\101\108\083\099\114\111\108\108\070\114\097\109\101\084\101\109\112\108\097\116\101")r:SetPoint("\084\079\080\076\069\070\084",10,-40)r:SetPoint("\066\079\084\084\079\077\082\073\071\072\084",-10,10)local T=l("\070\114\097\109\101",i.."\083\099\114\111\108\108\067\111\110\116\101\110\116",r)T:SetWidth(r:GetWidth()-20)T:SetHeight(1)r:SetScrollChild(T)local S=_G[i.."\083\099\114\111\108\108\070\114\097\109\101\083\099\114\111\108\108\066\097\114"]S:SetPoint("\084\079\080\076\069\070\084",r,"\084\079\080\082\073\071\072\084",-20,-16)S:SetPoint("\066\079\084\084\079\077\076\069\070\084",r,"\066\079\084\084\079\077\082\073\071\072\084",-20,16)local e=u:CreateFontString(nil,"\065\082\084\087\079\082\075","\071\097\109\101\070\111\110\116\078\111\114\109\097\108\076\097\114\103\101")e:SetPoint("\084\079\080\076\069\070\084",16,-16)e:SetText(i)InterfaceOptions_AddCategory(u)local N={frame=u;scrollFrame=r,scrollContent=T,elements={};lastY=0;totalHeight=0;maxHeight=r:GetHeight()}table.insert(x.subMenus,N)return N end function NSQCMenu.addSlider(u,i,x)local r=l("\083\108\105\100\101\114",i.frame:GetName()..x.name,i.scrollContent,"\079\112\116\105\111\110\115\083\108\105\100\101\114\084\101\109\112\108\097\116\101")r:SetPoint("\084\079\080\076\069\070\084",16,-i.lastY)r:SetWidth(590)r:SetHeight(20)r:SetMinMaxValues(x.min,x.max)r:SetValueStep(x.step or 1)r:SetValue(x.default)r.tooltipText=x.tooltip _G[r:GetName().."\084\101\120\116"]:SetText(x.label)_G[r:GetName().."\076\111\119"]:SetText(x.min)_G[r:GetName().."\072\105\103\104"]:SetText(x.max)r:SetScript("\079\110\069\110\116\101\114",function(i)if i.tooltipText then GameTooltip:SetOwner(i,"\065\078\067\072\079\082\095\082\073\071\072\084")GameTooltip:AddLine(i.tooltipText,1,1,1,true)GameTooltip:AddLine("\208\162\208\181\208\186\209\131\209\137\208\181\208\181 \208\183\208\189\208\176\209\135\208\181\208\189\208\184\208\181\058 \124\099\102\102\102\102\102\102\102\102"..(i:GetValue().."\124\114"),1,1,1,true)GameTooltip:Show()end end)r:SetScript("\079\110\076\101\097\118\101",function(i)GameTooltip:Hide()end)r:SetScript("\079\110\086\097\108\117\101\067\104\097\110\103\101\100",function(i,u)if x.onChange then x.onChange(u)end if GameTooltip:IsOwned(i)then GameTooltip:ClearLines()GameTooltip:SetOwner(i,"\065\078\067\072\079\082\095\082\073\071\072\084")GameTooltip:AddLine(i.tooltipText,1,1,1,true)GameTooltip:AddLine("\208\162\208\181\208\186\209\131\209\137\208\181\208\181 \208\183\208\189\208\176\209\135\208\181\208\189\208\184\208\181\058 \124\099\102\102\102\102\102\102\102\102"..(u.."\124\114"),1,1,1,true)GameTooltip:Show()end end)i.lastY=i.lastY+40 i.totalHeight=i.totalHeight+40 i.scrollContent:SetHeight(i.totalHeight)table.insert(i.elements,r)u:updateScrollRange(i)return r end function NSQCMenu.addCheckbox(u,i,x)local r=l("\067\104\101\099\107\066\117\116\116\111\110",i.frame:GetName()..x.name,i.scrollContent,"\067\104\097\116\067\111\110\102\105\103\067\104\101\099\107\066\117\116\116\111\110\084\101\109\112\108\097\116\101")r:SetPoint("\084\079\080\076\069\070\084",16,-i.lastY)r:SetChecked(x.default or false)r.tooltipText=x.tooltip local T=i.scrollContent:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108")T:SetPoint("\076\069\070\084",r,"\082\073\071\072\084",5,0)T:SetText(x.label)r:SetScript("\079\110\069\110\116\101\114",function(i)if i.tooltipText then GameTooltip:SetOwner(i,"\065\078\067\072\079\082\095\082\073\071\072\084")GameTooltip:AddLine(i.tooltipText,1,1,1,true)local x=i:GetChecked()and"\124\099\102\102\048\048\102\102\048\048\208\146\208\186\208\187\209\142\209\135\208\181\208\189\208\190\124\114"or"\124\099\102\102\102\102\048\048\048\048\208\146\209\139\208\186\208\187\209\142\209\135\208\181\208\189\208\190\124\114"GameTooltip:AddLine("\208\162\208\181\208\186\209\131\209\137\208\181\208\181 \208\183\208\189\208\176\209\135\208\181\208\189\208\184\208\181\058 "..x,1,1,1,true)GameTooltip:Show()end end)r:SetScript("\079\110\076\101\097\118\101",function(i)GameTooltip:Hide()end)r:SetScript("\079\110\067\108\105\099\107",function(i)if x.onClick then x.onClick(i:GetChecked())end if GameTooltip:IsOwned(i)then GameTooltip:ClearLines()GameTooltip:SetOwner(i,"\065\078\067\072\079\082\095\082\073\071\072\084")GameTooltip:AddLine(i.tooltipText,1,1,1,true)local x=i:GetChecked()and"\124\099\102\102\048\048\102\102\048\048\208\146\208\186\208\187\209\142\209\135\208\181\208\189\208\190\124\114"or"\124\099\102\102\102\102\048\048\048\048\208\146\209\139\208\186\208\187\209\142\209\135\208\181\208\189\208\190\124\114"GameTooltip:AddLine("\208\162\208\181\208\186\209\131\209\137\208\181\208\181 \208\183\208\189\208\176\209\135\208\181\208\189\208\184\208\181\058 "..x,1,1,1,true)GameTooltip:Show()end end)i.lastY=i.lastY+30 i.totalHeight=i.totalHeight+30 i.scrollContent:SetHeight(i.totalHeight)table.insert(i.elements,r)u:updateScrollRange(i)return r end function NSQCMenu.updateScrollRange(x,i)local u=i.scrollFrame local r=_G[u:GetName().."\083\099\114\111\108\108\066\097\114"]if not r then error("\083\099\114\111\108\108\098\097\114 \110\111\116 \102\111\117\110\100 \102\111\114 \115\099\114\111\108\108\070\114\097\109\101\058 "..u:GetName())end local l=i.totalHeight-i.maxHeight if l<0 then l=0 end r:SetMinMaxValues(0,l)r:SetValue(0)u:UpdateScrollChildRect()end QuestUI={}QuestUI.__index=QuestUI function QuestUI.Create(x,i)local r=u({},QuestUI)r.mainFrame=l("\070\114\097\109\101",nil,i or UIParent)r.mainFrame:SetSize(400,500)r.mainFrame:SetPoint("\067\069\078\084\069\082")r.mainFrame:SetMovable(true)r.mainFrame:EnableMouse(true)r.mainFrame:RegisterForDrag("\076\101\102\116\066\117\116\116\111\110")r.mainFrame:SetScript("\079\110\068\114\097\103\083\116\097\114\116",r.mainFrame.StartMoving)r.mainFrame:SetScript("\079\110\068\114\097\103\083\116\111\112",r.mainFrame.StopMovingOrSizing)r.mainFrame:SetBackdrop({bgFile="\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\087\072\073\084\069\056\088\056",edgeFile="\073\110\116\101\114\102\097\099\101\092\068\105\097\108\111\103\070\114\097\109\101\092\085\073-\068\105\097\108\111\103\066\111\120-\066\111\114\100\101\114";tile=true;tileSize=32,edgeSize=32;insets={left=11,right=12,top=12,bottom=11}})r.mainFrame:SetFrameStrata("\070\085\076\076\083\067\082\069\069\078")r.mainFrame:SetAlpha(1)r.mainFrame:SetBackdropColor(0,0,0,1)local T=l("\070\114\097\109\101",nil,r.mainFrame)T:SetPoint("\084\079\080\076\069\070\084",r.mainFrame,"\084\079\080\076\069\070\084",0,0)T:SetPoint("\084\079\080\082\073\071\072\084",r.mainFrame,"\084\079\080\082\073\071\072\084",0,0)T:SetHeight(35)T:SetBackdrop({bgFile="\073\110\116\101\114\102\097\099\101\092\068\105\097\108\111\103\070\114\097\109\101\092\085\073-\068\105\097\108\111\103\066\111\120-\072\101\097\100\101\114",edgeFile="\073\110\116\101\114\102\097\099\101\092\068\105\097\108\111\103\070\114\097\109\101\092\085\073-\068\105\097\108\111\103\066\111\120-\066\111\114\100\101\114";tile=true;tileSize=32;edgeSize=32;insets={left=11,right=12,top=12,bottom=11}})T:SetBackdropColor(0,0,0,1)local S=T:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\072\105\103\104\108\105\103\104\116")S:SetPoint("\067\069\078\084\069\082",T,"\067\069\078\084\069\082",0,0)S:SetText("\208\154\208\178\208\181\209\129\209\130")r.closeButton=l("\066\117\116\116\111\110",nil,r.mainFrame,"\085\073\080\097\110\101\108\067\108\111\115\101\066\117\116\116\111\110")r.closeButton:SetPoint("\084\079\080\082\073\071\072\084",-3,0)r.closeButton:SetScript("\079\110\067\108\105\099\107",function()r:Hide()end)r.leftItemsFrame=r:_CreateSideFrame("\076\069\070\084","\084\079\080",300,300,"\208\155\208\190\208\186\208\176\209\134\208\184\208\184")r.rightItemsFrame=r:_CreateSideFrame("\082\073\071\072\084","\084\079\080",300,300,"\208\159\209\128\208\181\208\180\208\188\208\181\209\130\209\139")r.actionsFrame=r:_CreateSideFrame("\082\073\071\072\084","\066\079\084\084\079\077",300,200,"\208\148\208\181\208\185\209\129\209\130\208\178\208\184\209\143")r:_SetupQuestText()return r end function QuestUI._CreateSideFrame(S,i,x,u,r,T)local e=l("\070\114\097\109\101",nil,S.mainFrame)e:SetSize(u,r)if i=="\076\069\070\084"then e:SetPoint("\082\073\071\072\084",S.mainFrame,"\076\069\070\084",-10,0)else e:SetPoint("\076\069\070\084",S.mainFrame,"\082\073\071\072\084",10,0)end e:SetPoint(x,S.mainFrame,x,0,0)e:SetBackdrop({bgFile="\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\087\072\073\084\069\056\088\056",edgeFile="\073\110\116\101\114\102\097\099\101\092\084\111\111\108\116\105\112\115\092\085\073-\084\111\111\108\116\105\112-\066\111\114\100\101\114";tile=true;tileSize=16;edgeSize=16,insets={left=4,right=4;top=4;bottom=4}})e:SetBackdropColor(0,0,0,1)local N=l("\070\114\097\109\101",nil,e)N:SetPoint("\084\079\080\076\069\070\084",e,"\084\079\080\076\069\070\084",0,0)N:SetPoint("\084\079\080\082\073\071\072\084",e,"\084\079\080\082\073\071\072\084",0,0)N:SetHeight(35)N:SetBackdrop({bgFile="\073\110\116\101\114\102\097\099\101\092\068\105\097\108\111\103\070\114\097\109\101\092\085\073-\068\105\097\108\111\103\066\111\120-\072\101\097\100\101\114";edgeFile="\073\110\116\101\114\102\097\099\101\092\068\105\097\108\111\103\070\114\097\109\101\092\085\073-\068\105\097\108\111\103\066\111\120-\066\111\114\100\101\114";tile=true,tileSize=32;edgeSize=32,insets={left=11,right=12,top=12,bottom=11}})N:SetBackdropColor(0,0,0,1)local B=N:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\072\105\103\104\108\105\103\104\116")B:SetPoint("\067\069\078\084\069\082",N,"\067\069\078\084\069\082",0,0)B:SetText(T)local c=l("\083\099\114\111\108\108\070\114\097\109\101",nil,e)c:SetPoint("\084\079\080\076\069\070\084",8,-43)c:SetPoint("\066\079\084\084\079\077\082\073\071\072\084",-8,8)local b=l("\083\108\105\100\101\114",nil,c,"\085\073\080\097\110\101\108\083\099\114\111\108\108\066\097\114\084\101\109\112\108\097\116\101")b:SetPoint("\084\079\080\082\073\071\072\084",8,-16)b:SetPoint("\066\079\084\084\079\077\082\073\071\072\084",8,16)b:SetWidth(16)b:SetScript("\079\110\086\097\108\117\101\067\104\097\110\103\101\100",function(i,x)c:SetVerticalScroll(x)end)local o=l("\070\114\097\109\101")o:SetSize(u-16,1)c:SetScrollChild(o)return{frame=e;scrollFrame=c,scrollBar=b;content=o;items={},title=B}end function QuestUI._SetupQuestText(i)i.questScroll=l("\083\099\114\111\108\108\070\114\097\109\101",nil,i.mainFrame)i.questScroll:SetPoint("\084\079\080\076\069\070\084",15,-15)i.questScroll:SetSize(370,475)i.mainScrollBar=l("\083\108\105\100\101\114",nil,i.questScroll,"\085\073\080\097\110\101\108\083\099\114\111\108\108\066\097\114\084\101\109\112\108\097\116\101")i.mainScrollBar:SetPoint("\084\079\080\082\073\071\072\084",0,-30)i.mainScrollBar:SetPoint("\066\079\084\084\079\077\082\073\071\072\084",-8,16)i.mainScrollBar:SetWidth(16)i.mainScrollBar:SetScript("\079\110\086\097\108\117\101\067\104\097\110\103\101\100",function(x,u)i.questScroll:SetVerticalScroll(u)end)i.questContent=l("\070\114\097\109\101")i.questContent:SetSize(340,1)i.questScroll:SetScrollChild(i.questContent)i.questText=i.questContent:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108")i.questText:SetPoint("\084\079\080\076\069\070\084",10,-25)i.questText:SetJustifyH("\076\069\070\084")i.questText:SetWordWrap(true)i.questText:SetWidth(325)end function QuestUI.SetQuestText(x,i)x.questText:SetText(i)local u=x.questText:GetStringHeight()x.questContent:SetHeight(math.max(u+20,475))x:_UpdateScroll({scrollFrame=x.questScroll,scrollBar=x.mainScrollBar,content=x.questContent})end function QuestUI.AddItem(u,i,x)u:_AddListElement(u.rightItemsFrame,i,x)end function QuestUI.AddLocationItem(u,i,x)u:_AddListElement(u.leftItemsFrame,i,x)end function QuestUI.AddAction(u,i,x)u:_AddListElement(u.actionsFrame,i,x)end function QuestUI._AddListElement(r,i,x,u)local T=l("\066\117\116\116\111\110",nil,i.content)T:SetHeight(20)T.textField=T:CreateFontString(nil,"\079\086\069\082\076\065\089","\071\097\109\101\070\111\110\116\078\111\114\109\097\108")T.textField:SetText(x)T.textField:SetPoint("\076\069\070\084")local S=T.textField:GetStringWidth()T:SetWidth(S)local e=-(#i.items*20)T:SetPoint("\084\079\080\076\069\070\084",10,e)T:SetHighlightTexture("\073\110\116\101\114\102\097\099\101\092\081\117\101\115\116\070\114\097\109\101\092\085\073-\081\117\101\115\116\084\105\116\108\101\072\105\103\104\108\105\103\104\116");(T:GetHighlightTexture()):SetAlpha(.6)T:SetScript("\079\110\067\108\105\099\107",u)table.insert(i.items,T)i.content:SetHeight(#i.items*20)r:_UpdateFrameWidth(i)r:_UpdateScroll(i)end function QuestUI._UpdateFrameWidth(x,i)local u=0 for i,x in e(i.items)do local r=x.textField:GetStringWidth()if r>u then u=r end end local r=u+20 i.frame:SetWidth(r+16)i.content:SetWidth(r)end function QuestUI._UpdateScroll(x,i)local u=i.content:GetHeight()local r=i.scrollFrame:GetHeight()local l=math.max(0,u-r)i.scrollBar:SetMinMaxValues(0,l)i.scrollBar:SetValue(0)if l>0 then i.scrollBar:Show()else i.scrollBar:Hide()end end function QuestUI.ClearItems(i)i:_ClearFrame(i.rightItemsFrame)end function QuestUI.ClearLocationItems(i)i:_ClearFrame(i.leftItemsFrame)end function QuestUI.ClearActions(i)i:_ClearFrame(i.actionsFrame)end function QuestUI._ClearFrame(x,i)for i,x in e(i.items)do x:Hide()x:SetParent(nil)end i.items={}i.content:SetHeight(0)i.frame:SetWidth(230)i.content:SetWidth(214)x:_UpdateScroll(i)end function QuestUI.Show(i)i.mainFrame:Show()i.leftItemsFrame.frame:Show()i.rightItemsFrame.frame:Show()i.actionsFrame.frame:Show()end function QuestUI.Hide(i)i.mainFrame:Hide()i.leftItemsFrame.frame:Hide()i.rightItemsFrame.frame:Hide()i.actionsFrame.frame:Hide()end