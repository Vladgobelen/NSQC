local b={HPheight=4;HPwidth=99;CBheight=5,CBtieFont=10;border=2;rheight=15,Rpoint="\082\073\071\072\084";RrelativePoint="\076\069\070\084";Rx=0;Ry=-4;LvLFontSize=13;LvLpoint="\082\073\071\072\084";LvLrelativePoint="\076\069\070\084";LvLx=-2;LvLy=0,NameFontSize=11,Npoint="\066\079\084\084\079\077";NrelativePoint="\084\079\080",Nx=0,Ny=4;hostileunit={r=.77;g=.11,b=.11},friendlyunit={r=.6,g=.88;b=.99},friendlyplayer={r=.11000000000001;g=.88,b=.11},neutralunit={r=.99,g=.99,b=0}}local h={font="\070\111\110\116\115\092\070\082\073\090\081\084\095\095\046\084\084\070";normTex="\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\087\072\073\084\069\056\120\056",glowTex="\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\087\072\073\084\069\056\120\056",back="\073\110\116\101\114\102\097\099\101\092\066\117\116\116\111\110\115\092\087\072\073\084\069\056\120\056"}local K={edgeFile=h.glowTex,edgeSize=b.border;insets={left=b.border;right=b.border,top=b.border;bottom=b.border}}local l=-1 local B={}local function r(b,h,...)local K=...local l=K if K~=l and K=="\112\108\097\121\101\114"then return end local B=string.gsub((select(7,(b:GetParent()):GetRegions())):GetText(),"\037\115\037\040\037\042\037\041","")if not(B==UnitName(l)and((b:GetParent()):GetChildren()):GetValue()==UnitHealth(l))then return end if h=="\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\083\084\065\082\084"then local h=0 local K local B local r local p local Q local k local o local f local S while true do if h==2 then b:SetMinMaxValues(0,b.max)b:SetAlpha(1)if b.Icon then b.Icon:SetTexture(p)end h=3 end if h==1 then b.duration=GetTime()-Q/1000 b.max=(k-Q)/1000 b:SetValue(0)h=2 end if h==5 then b.fadeOut=nil if b.Shield then if b.showShield and S then b.Shield:Show()if b.Border then b.Border:Hide()end else local h=0 while true do if h==0 then b.Shield:Hide()if b.Border then b.Border:Show()end break end end end end b:Show()break end if h==0 then K,B,r,p,Q,k,o,f,S=UnitCastingInfo(l)if not K or not b.showTradeSkills and o then local h=0 while true do if h==0 then b:Hide()return end end end b:SetStatusBarColor(1,.7,0)h=1 end if h==3 then b:SetAlpha(1)b.holdTime=0 b.casting=1 h=4 end if h==4 then b.castID=f b.delay=0 b.channeling=nil h=5 end end elseif h=="\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\083\084\079\080"or h=="\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\067\072\065\078\078\069\076\095\083\084\079\080"then if b.casting and(h=="\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\083\084\079\080"and select(4,...)==b.castID)or b.channeling and h=="\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\067\072\065\078\078\069\076\095\083\084\079\080"then local K if b.max==nil then local h=0 while true do if h==0 then K=1.5 b:SetValue(K)break end end else b:SetValue(b.max)end if h=="\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\083\084\079\080"then local h=0 while true do if h==0 then b.casting=nil b:SetStatusBarColor(0,1,0)break end end else b.channeling=nil end b.flash=1 b.fadeOut=1 b.holdTime=0 end elseif h=="\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\070\065\073\076\069\068"or h=="\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\073\078\084\069\082\082\085\080\084\069\068"then if b:IsShown()and(b.casting and(select(4,...)==b.castID and not b.fadeOut))then b:SetValue(b.max)b:SetStatusBarColor(1,0,0)b.casting=nil b.channeling=nil b.fadeOut=1 b.holdTime=GetTime()+CASTING_BAR_HOLD_TIME end elseif h=="\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\068\069\076\065\089\069\068"then local h=0 local K while true do if h==0 then K=b if K:IsShown()then local h=0 local B local r local p local Q local k local o local f local S while true do if h==3 then K:SetValue(S)if not K.casting then local b=0 while true do if b==1 then K.channeling=nil K.fadeOut=0 break end if b==0 then K:SetStatusBarColor(1,.70000000000005,0)K.casting=1 b=1 end end end break end if 1==h then S=GetTime()-k/1000 if S<0 then S=0 end h=2 end if 2==h then K.delay=(K.delay+K.duration)-S K.duration=S h=3 end if h==0 then B,r,p,Q,k,o,f=UnitCastingInfo(l)if not B or not b.showTradeSkills and f then local h=0 while true do if 0==h then b:Hide()return end end end h=1 end end end break end end elseif h=="\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\067\072\065\078\078\069\076\095\083\084\065\082\084"then local h,K,B,r,p,Q,k,o=UnitChannelInfo(l)if not h or not b.showTradeSkills and k then local h=0 while true do if h==0 then b:Hide()return end end end b:SetStatusBarColor(0,1,0)b.duration=Q/1000-GetTime()b.max=(Q-p)/1000 b.delay=0 b:SetMinMaxValues(0,b.max)b:SetValue(b.duration)if b.Icon then b.Icon:SetTexture(r)end b:SetAlpha(1)b.holdTime=0 b.casting=nil b.channeling=1 b.fadeOut=nil if b.Shield then if b.showShield and o then local h=0 while true do if h==0 then b.Shield:Show()if b.Border then b.Border:Hide()end break end end else b.Shield:Hide()if b.Border then b.Border:Show()end end end b:Show()elseif h=="\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\067\072\065\078\078\069\076\095\085\080\068\065\084\069"then local h=0 local K while true do if h==0 then K=b if K:IsShown()then local h=0 local B local r local p local Q local k local o local f local S while true do if h==1 then S=o/1000-GetTime()K.delay=(K.delay+K.duration)-S h=2 end if h==0 then B,r,p,Q,k,o,f=UnitChannelInfo(l)if not B or not b.showTradeSkills and f then b:Hide()return end h=1 end if h==3 then K:SetMinMaxValues(0,K.max)K:SetValue(S)break end if h==2 then K.duration=S K.max=(o-k)/1000 h=3 end end end break end end elseif h=="\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\073\078\084\069\082\082\085\080\084\073\066\076\069"then if b.Shield then local h=0 while true do if h==0 then b.Shield:Hide()if b.Border then b.Border:Show()end break end end end elseif h=="\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\078\079\084\095\073\078\084\069\082\082\085\080\084\073\066\076\069"then if b.Shield then b.Shield:Show()if b.Border then b.Border:Hide()end end end end local function p(b,h)if b.casting then local K=0 local l while true do if K==1 then b.duration=l b:SetValue(l)break end if K==0 then l=b.duration+h if l>=b.max then b:SetValue(b.max)b:SetStatusBarColor(0,1,0)b.holdTime=0 b.fadeOut=0 b.casting=nil return end K=1 end end elseif b.channeling then local K=b.duration-h if K<=0 then local h=0 while true do if h==1 then b.channeling=nil b.holdTime=0 h=2 end if h==2 then return end if h==0 then b:SetStatusBarColor(0,1,0)b.fadeOut=0 h=1 end end end b.duration=K b:SetValue(K)elseif GetTime()<b.holdTime then return elseif b.fadeOut then local h=0 local K while true do if h==0 then K=b:GetAlpha()-CASTING_BAR_ALPHA_STEP if K>.049999999999955 then b:SetAlpha(K)else b.fadeOut=nil b:Hide()end break end end end end local function Q(b,h)local K=0 local l local B while true do if K==0 then l,B=b:GetMinMaxValues()if b.channeling then local K=0 local l local r while true do if 0==K then l=string.format("\037\046\049\102",h)r=string.format("\n\037\046\049\102",B)K=1 end if 1==K then b.time:SetText(l..r)break end end else local K=0 local l local r while true do if 1==K then b.time:SetText(l..r)break end if K==0 then l=string.format("\037\046\049\102",B-h)r=string.format("\n\037\046\049\102",B)K=1 end end end break end end end local function k(h)local K,l,B=h:GetStatusBarColor()if l+B==0 then h.r,h.g,h.b=b.hostileunit.r,b.hostileunit.g,b.hostileunit.b h:SetStatusBarColor(b.hostileunit.r,b.hostileunit.g,b.hostileunit.b)elseif K+B==0 then local K=0 while true do if K==0 then h.r,h.g,h.b=b.friendlyunit.r,b.friendlyunit.g,b.friendlyunit.b h:SetStatusBarColor(b.friendlyunit.r,b.friendlyunit.g,b.friendlyunit.b)break end end elseif K+l==0 then h.r,h.g,h.b=b.friendlyplayer.r,b.friendlyplayer.g,b.friendlyplayer.b h:SetStatusBarColor(b.friendlyplayer.r,b.friendlyplayer.g,b.friendlyplayer.b)elseif 2-(K+l)<.049999999999955 and B==0 then local K=0 while true do if 0==K then h.r,h.g,h.b=b.neutralunit.r,b.neutralunit.g,b.neutralunit.b h:SetStatusBarColor(b.neutralunit.r,b.neutralunit.g,b.neutralunit.b)break end end else h.r,h.g,h.b=K,l,B end frame=h:GetParent()if not frame.oldglow:IsShown()then h.hpBorder:SetBackdropBorderColor(0,0,0)else local b,K,l=frame.oldglow:GetVertexColor()if K+l==0 then h.hpBorder:SetBackdropBorderColor(1,0,0)else h.hpBorder:SetBackdropBorderColor(1,1,0)end end h:SetStatusBarColor(h.r,h.g,h.b)h:ClearAllPoints()h:SetPoint("\067\069\078\084\069\082",h:GetParent(),0,10)h:SetHeight(b.HPheight)h:SetWidth(b.HPwidth)h.hpBackground:SetVertexColor(h.r*.25,h.g*.25,h.b*.25)local r=frame.oldname:GetText()if string.len(r)<b.HPwidth/5 then frame.name:SetText(r)else frame.name:SetFormattedText(r:sub(0,b.HPwidth/5).."\046\046\046")end frame.level:ClearAllPoints()frame.level:SetPoint(b.LvLpoint,frame.healthBar,b.LvLrelativePoint,b.LvLx,b.LvLy)if frame.boss:IsShown()then frame.level:SetText("\208\145\208\158\208\161")frame.level:SetTextColor(.8,.05,0)frame.level:Show()end frame.highlight:SetAllPoints(h)end local function o(b)b.highlight:Hide()end local function f(l)l.healthBar,l.castBar=l:GetChildren()local f,S=l.healthBar,l.castBar local O,T,e,G,H,C,E,N,A,d,M=l:GetRegions()l.oldname=E E:Hide()E.Show=function() end l.name=l:CreateFontString()l.name:SetPoint(b.Npoint,f,b.NrelativePoint,b.Nx,b.Ny)l.name:SetFont(h.font,b.NameFontSize,"\079\085\084\076\073\078\069")l.name:SetTextColor(.83999999999997,.75,.65)l.name:SetShadowOffset(1,-1)l.level=N N:SetFont(h.font,b.LvLFontSize,"\079\085\084\076\073\078\069")N:SetShadowOffset(1,-1)l.boss=A f:SetStatusBarTexture(h.normTex)f.hpBackground=f:CreateTexture(nil,"\066\079\082\068\069\082")f.hpBackground:SetAllPoints(f)f.hpBackground:SetTexture(h.back)f.hpBackground:SetVertexColor(.15,.15000000000009,.15)f.hpBorder=CreateFrame("\070\114\097\109\101",nil,f)f.hpBorder:SetFrameLevel(f:GetFrameLevel()-1>0 and f:GetFrameLevel()-1 or 0)f.hpBorder:SetPoint("\084\079\080\076\069\070\084",f,"\084\079\080\076\069\070\084",-b.border,b.border)f.hpBorder:SetPoint("\066\079\084\084\079\077\082\073\071\072\084",f,"\066\079\084\084\079\077\082\073\071\072\084",b.border,-b.border)f.hpBorder:SetBackdrop(K)f.hpBorder:SetBackdropColor(0,0,0)f.hpBorder:SetBackdropBorderColor(0,0,0)f:SetScript("\079\110\085\112\100\097\116\101",k)C:SetTexture(h.normTex)C:SetVertexColor(.25,.25,.25)l.highlight=C local i=CreateFrame("\083\116\097\116\117\115\066\097\114",nil,l)i:SetHeight(b.CBheight)i:SetWidth(b.HPwidth-(b.CBheight+8))i:SetStatusBarTexture(h.normTex);(i:GetStatusBarTexture()):SetHorizTile(false);(i:GetStatusBarTexture()):SetVertTile(false)i:SetPoint("\084\079\080\082\073\071\072\084",f,"\066\079\084\084\079\077\082\073\071\072\084",0,-8)i.showTradeSkills=true i.showShield=true i.casting=true i.channeling=true i.holdTime=0 i.Border=i:CreateTexture(nil,"\066\065\067\075\071\082\079\085\078\068")i.Border:SetSize(e:GetSize())i.Border:SetAllPoints(i)i.Border:SetTexture(h.back)i.Border:SetVertexColor(0,0,0,.8)i.Icon=i:CreateTexture(nil,"\065\082\084\087\079\082\075")i.Icon:SetSize(H:GetSize())i.Icon:SetPoint("\082\073\071\072\084",i,"\076\069\070\084",-2,0)i.Icon:SetTexCoord(.1,.90000000000009,.1,.9)i.time=i:CreateFontString(nil,"\065\082\084\087\079\082\075")i.time:SetPoint("\082\073\071\072\084",i.Icon,"\076\069\070\084",-4,0)i.time:SetFont(h.font,b.CBtieFont,"\079\085\084\076\073\078\069")i.time:SetTextColor(.84,.75,.64999999999998)i.time:SetShadowOffset(1,-1)i:Hide()i:RegisterEvent("\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\083\084\065\082\084")i:RegisterEvent("\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\070\065\073\076\069\068")i:RegisterEvent("\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\083\084\079\080")i:RegisterEvent("\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\073\078\084\069\082\082\085\080\084\069\068")i:RegisterEvent("\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\073\078\084\069\082\082\085\080\084\073\066\076\069")i:RegisterEvent("\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\078\079\084\095\073\078\084\069\082\082\085\080\084\073\066\076\069")i:RegisterEvent("\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\068\069\076\065\089\069\068")i:RegisterEvent("\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\067\072\065\078\078\069\076\095\083\084\065\082\084")i:RegisterEvent("\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\067\072\065\078\078\069\076\095\085\080\068\065\084\069")i:RegisterEvent("\085\078\073\084\095\083\080\069\076\076\067\065\083\084\095\067\072\065\078\078\069\076\095\083\084\079\080")i:SetScript("\079\110\069\118\101\110\116",r)i:SetScript("\079\110\085\112\100\097\116\101",p)i:HookScript("\079\110\086\097\108\117\101\067\104\097\110\103\101\100",Q)l.oldglow=O l:SetScript("\079\110\072\105\100\101",o)B[l]=true O:SetTexture(nil)T:SetTexture(nil)G:SetTexture(nil)e:SetTexture(nil)M:SetTexture(nil)A:SetTexture(nil)end local S=select local function O(...)for b=1,S("\035",...),1 do local h=0 local K local l while true do if h==0 then K=S(b,...)l=K:GetRegions()h=1 end if h==1 then if not B[K]and(not K:GetName()and(l and(l:GetObjectType()=="\084\101\120\116\117\114\101"and l:GetTexture()=="\073\110\116\101\114\102\097\099\101\092\084\097\114\103\101\116\105\110\103\070\114\097\109\101\092\085\073-\084\097\114\103\101\116\105\110\103\070\114\097\109\101-\070\108\097\115\104")))then f(K)end break end end end end local T=.1;(CreateFrame("\070\114\097\109\101")):SetScript("\079\110\085\112\100\097\116\101",function(b,h)if testQ.np==1 then if WorldFrame:GetNumChildren()~=l then local b=0 while true do if b==0 then l=WorldFrame:GetNumChildren()O(WorldFrame:GetChildren())break end end end end end)